{"version":3,"file":"hooks.js","names":["_react","_interopRequireWildcard","require","_xmlchecker","_interopRequireDefault","_codemirror","_state","_view","_langHtml","_langXml","_lint","_constants","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","CODEMIRROR_LANGUAGES","HTML","XML","state","exports","showBtnEscapeHTML","val","React","useState","prepareShowBtnEscapeHTML","visibility","setVisibility","hide","hideBtn","cleanHTML","_ref","initialText","translateRegex","RegExp","keys","alphanumericMap","join","translator","$0","$1","replace","syntaxChecker","_ref2","textArr","lang","diagnostics","docString","xmlDoc","xmlChecker","check","error","errorStart","line","length","errorLine","errorEnd","push","from","to","severity","message","name","createCodeMirrorDomNode","_ref3","ref","upstreamRef","useEffect","languageExtension","html","xml","cleanText","newState","EditorState","create","doc","extensions","basicSetup","EditorView","lineWrapping","linter","view","text","parent","current","focus","destroy","escapeHTMLSpecialChars","_ref4","toString","pos","changes","forEach","escapedKeyword","next","indexOf","insert","dispatch"],"sources":["../../../../src/editors/sharedComponents/CodeEditor/hooks.js"],"sourcesContent":["import React, { useEffect } from 'react';\nimport xmlChecker from 'xmlchecker';\n\nimport { basicSetup } from 'codemirror';\nimport { EditorState } from '@codemirror/state';\nimport { EditorView } from '@codemirror/view';\nimport { html } from '@codemirror/lang-html';\nimport { xml } from '@codemirror/lang-xml';\nimport { linter } from '@codemirror/lint';\nimport alphanumericMap from './constants';\nimport './index.scss';\n\nconst CODEMIRROR_LANGUAGES = { HTML: 'html', XML: 'xml' };\n\nexport const state = {\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  showBtnEscapeHTML: (val) => React.useState(val),\n};\n\nexport const prepareShowBtnEscapeHTML = () => {\n  const [visibility, setVisibility] = state.showBtnEscapeHTML(true);\n  const hide = () => setVisibility(false);\n  return { showBtnEscapeHTML: visibility, hideBtn: hide };\n};\n\nexport const cleanHTML = ({ initialText }) => {\n  const translateRegex = new RegExp(`&(${Object.keys(alphanumericMap).join('|')});`, 'g');\n  const translator = ($0, $1) => alphanumericMap[$1];\n  return initialText.replace(translateRegex, translator);\n};\n\nexport const syntaxChecker = ({ textArr, lang }) => {\n  const diagnostics = [];\n  if (lang === 'xml' && textArr) {\n    const docString = textArr.join('\\n');\n    const xmlDoc = `<?xml version=\"1.0\" encoding=\"UTF-8\"?> ${docString}`;\n\n    try {\n      xmlChecker.check(xmlDoc);\n    } catch (error) {\n      let errorStart = 0;\n      for (let i = 0; i < error.line - 1; i++) {\n        errorStart += textArr[i].length;\n      }\n      const errorLine = error.line;\n      const errorEnd = errorStart + textArr[errorLine - 1].length;\n      diagnostics.push({\n        from: errorStart,\n        to: errorEnd,\n        severity: 'error',\n        message: `${error.name}: ${error.message}`,\n      });\n    }\n  }\n  return diagnostics;\n};\n\nexport const createCodeMirrorDomNode = ({\n  ref,\n  initialText,\n  upstreamRef,\n  lang,\n}) => {\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useEffect(() => {\n    const languageExtension = lang === CODEMIRROR_LANGUAGES.HTML ? html() : xml();\n    const cleanText = cleanHTML({ initialText });\n    const newState = EditorState.create({\n      doc: cleanText,\n      extensions: [\n        basicSetup,\n        languageExtension,\n        EditorView.lineWrapping,\n        linter((view) => {\n          const textArr = view.state.doc.text;\n          return syntaxChecker({ textArr, lang });\n        }),\n      ],\n    });\n    const view = new EditorView({ state: newState, parent: ref.current });\n    // eslint-disable-next-line no-param-reassign\n    upstreamRef.current = view;\n    view.focus();\n\n    return () => {\n      // called on cleanup\n      view.destroy();\n    };\n  }, []);\n};\n\nexport const escapeHTMLSpecialChars = ({ ref, hideBtn }) => {\n  const text = ref.current.state.doc.toString();\n  let pos = 0;\n  const changes = [];\n  Object.keys(alphanumericMap).forEach(\n    (escapedKeyword) => {\n      // eslint-disable-next-line no-cond-assign\n      for (let next; (next = text.indexOf(alphanumericMap[escapedKeyword], pos)) > -1;) {\n        changes.push({ from: next, to: next + 1, insert: `&${escapedKeyword};` });\n        pos = next + 1;\n      }\n    },\n  );\n\n  ref.current.dispatch({ changes });\n  hideBtn();\n};\n"],"mappings":"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"}