{"version":3,"file":"hooks.js","names":["_react","require","_tinyMCEStyles","_interopRequireDefault","_utils","_pluginConfig","_module","_interopRequireWildcard","_tinyMCE","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","TypeError","Number","state","StrictDict","isImageModalOpen","val","useState","isSourceCodeModalOpen","imageSelection","refReady","exports","parseContentForLabels","_ref","editor","updateContent","content","getContent","parsedLabels","split","updatedContent","label","startsWith","endsWith","previousLabel","nextLabel","replace","replaceStaticwithAsset","_ref2","imageUrls","editorType","lmsEndpointUrl","imageSrcs","src","currentContent","staticFullUrl","isStatic","isExpandableAsset","assetSrc","substring","indexOf","assetName","staticName","url","displayName","currentSrc","setContent","setupCustomBehavior","_ref3","openImgModal","openSourceCodeModal","setImage","ui","registry","addButton","tinyMCE","buttons","imageUploadButton","icon","tooltip","onAction","editImageSettings","module","openModalWithSelectedImage","code","text","setupCodeFormatting","api","formatter","formatChanged","active","setActive","toggleCodeFormatting","toggle","undoManager","add","focus","addToggleButton","codeBlock","onSetup","toggleLabelFormatting","execCommand","addIcon","textToSpeechIcon","on","e","command","remove","removeProtocolFromUrl","editorConfig","_ref4","setEditorRef","textValue","images","studioEndpointUrl","isLibrary","placeholder","initializeEditor","setSelection","minHeight","toolbar","config","plugins","imageToolbar","quickbarsInsertToolbar","quickbarsSelectionToolbar","pluginConfig","onInit","evt","initialValue","init","skin","content_css","content_style","tinyMCEStyles","min_height","contextmenu","document_base_url","imagetools_cors_hosts","imagetools_toolbar","formats","inline","setup","fetchImageUrls","quickbars_insert_toolbar","quickbars_selection_toolbar","quickbars_image_toolbar","valid_children","valid_elements","entity_encoding","prepareEditorRef","editorRef","useRef","useCallback","ref","current","setRefReady","useEffect","imgModalToggle","isImgOpen","setIsOpen","closeImgModal","sourceCodeModalToggle","isSourceCodeOpen","closeSourceCodeModal","_ref5","imgHTML","selection","getNode","externalUrl","altText","alt","width","height","filterAssets","_ref6","assets","assetsList","values","asset","contentType","setAssetToStaticUrl","_ref7","editorValue","regExLmsEndpointUrl","RegExp","assetUrls","portableUrl","assetSrcs","assetBlockName","search","nameFromEditorSrc","nameFromStudioSrc","image","selectedImage","clearSelection"],"sources":["../../../../src/editors/sharedComponents/TinyMceWidget/hooks.js"],"sourcesContent":["import {\n  useState,\n  useRef,\n  useCallback,\n  useEffect,\n} from 'react';\nimport tinyMCEStyles from '../../data/constants/tinyMCEStyles';\nimport { StrictDict } from '../../utils';\nimport pluginConfig from './pluginConfig';\nimport * as module from './hooks';\nimport tinyMCE from '../../data/constants/tinyMCE';\n\nexport const state = StrictDict({\n  isImageModalOpen: (val) => useState(val),\n  isSourceCodeModalOpen: (val) => useState(val),\n  imageSelection: (val) => useState(val),\n  refReady: (val) => useState(val),\n});\n\nexport const parseContentForLabels = ({ editor, updateContent }) => {\n  let content = editor.getContent();\n  if (content && content?.length > 0) {\n    const parsedLabels = content.split(/<label>|<\\/label>/gm);\n    let updatedContent;\n    parsedLabels.forEach((label, i) => {\n      if (!label.startsWith('<') && !label.endsWith('>')) {\n        let previousLabel = parsedLabels[i - 1];\n        let nextLabel = parsedLabels[i + 1];\n        if (!previousLabel.endsWith('<p>')) {\n          previousLabel = `${previousLabel}</p><p>`;\n          updatedContent = content.replace(parsedLabels[i - 1], previousLabel);\n          content = updatedContent;\n          updateContent(content);\n        }\n        if (!nextLabel.startsWith('</p>')) {\n          nextLabel = `</p><p>${nextLabel}`;\n          updatedContent = content.replace(parsedLabels[i + 1], nextLabel);\n          content = updatedContent;\n          updateContent(content);\n        }\n      }\n    });\n  } else {\n    updateContent(content);\n  }\n};\n\nexport const replaceStaticwithAsset = ({\n  editor,\n  imageUrls,\n  editorType,\n  lmsEndpointUrl,\n  updateContent,\n}) => {\n  let content = editor.getContent();\n  const imageSrcs = content.split('src=\"');\n  imageSrcs.forEach(src => {\n    const currentContent = content;\n    let staticFullUrl;\n    const isStatic = src.startsWith('/static/');\n    const isExpandableAsset = src.startsWith('/assets/') && editorType === 'expandable';\n    if ((isStatic || isExpandableAsset) && imageUrls.length > 0) {\n      const assetSrc = src.substring(0, src.indexOf('\"'));\n      const assetName = assetSrc.replace(/\\/assets\\/.+[^/]\\//g, '');\n      const staticName = assetSrc.substring(8);\n      imageUrls.forEach((url) => {\n        if (isExpandableAsset && assetName === url.displayName) {\n          staticFullUrl = `${lmsEndpointUrl}${url.staticFullUrl}`;\n        } else if (staticName === url.displayName) {\n          staticFullUrl = url.staticFullUrl;\n          if (isExpandableAsset) {\n            staticFullUrl = `${lmsEndpointUrl}${url.staticFullUrl}`;\n          }\n        }\n      });\n      if (staticFullUrl) {\n        const currentSrc = src.substring(0, src.indexOf('\"'));\n        content = currentContent.replace(currentSrc, staticFullUrl);\n        if (editorType === 'expandable') {\n          updateContent(content);\n        } else {\n          editor.setContent(content);\n        }\n      }\n    }\n  });\n};\n\nexport const setupCustomBehavior = ({\n  updateContent,\n  openImgModal,\n  openSourceCodeModal,\n  setImage,\n  editorType,\n  imageUrls,\n  lmsEndpointUrl,\n}) => (editor) => {\n  // image upload button\n  editor.ui.registry.addButton(tinyMCE.buttons.imageUploadButton, {\n    icon: 'image',\n    tooltip: 'Add Image',\n    onAction: openImgModal,\n  });\n  // editing an existing image\n  editor.ui.registry.addButton(tinyMCE.buttons.editImageSettings, {\n    icon: 'image',\n    tooltip: 'Edit Image Settings',\n    onAction: module.openModalWithSelectedImage({ editor, setImage, openImgModal }),\n  });\n  // overriding the code plugin's icon with 'HTML' text\n  editor.ui.registry.addButton(tinyMCE.buttons.code, {\n    text: 'HTML',\n    tooltip: 'Source code',\n    onAction: openSourceCodeModal,\n  });\n  // add a custom simple inline code block formatter.\n  const setupCodeFormatting = (api) => {\n    editor.formatter.formatChanged(\n      'code',\n      (active) => api.setActive(active),\n    );\n  };\n  const toggleCodeFormatting = () => {\n    editor.formatter.toggle('code');\n    editor.undoManager.add();\n    editor.focus();\n  };\n  editor.ui.registry.addToggleButton(tinyMCE.buttons.codeBlock, {\n    icon: 'sourcecode',\n    tooltip: 'Code Block',\n    onAction: toggleCodeFormatting,\n    onSetup: setupCodeFormatting,\n  });\n  // add a custom simple inline label formatter.\n  const toggleLabelFormatting = () => {\n    editor.execCommand('mceToggleFormat', false, 'label');\n  };\n  editor.ui.registry.addIcon('textToSpeech', tinyMCE.textToSpeechIcon);\n  editor.ui.registry.addButton('customLabelButton', {\n    icon: 'textToSpeech',\n    text: 'Label',\n    tooltip: 'Apply a \"Question\" label to specific text, recognized by screen readers. Recommended to improve accessibility.',\n    onAction: toggleLabelFormatting,\n  });\n  if (editorType === 'expandable') {\n    editor.on('init', () => {\n      module.replaceStaticwithAsset({\n        editor,\n        imageUrls,\n        editorType,\n        lmsEndpointUrl,\n        updateContent,\n      });\n    });\n  }\n  editor.on('ExecCommand', (e) => {\n    if (editorType === 'text' && e.command === 'mceFocus') {\n      module.replaceStaticwithAsset({ editor, imageUrls });\n    }\n    if (e.command === 'RemoveFormat') {\n      editor.formatter.remove('blockquote');\n      editor.formatter.remove('label');\n    }\n  });\n};\n\n// imagetools_cors_hosts needs a protocol-sanatized url\nexport const removeProtocolFromUrl = (url) => url.replace(/^https?:\\/\\//, '');\n\nexport const editorConfig = ({\n  editorType,\n  setEditorRef,\n  textValue,\n  images,\n  lmsEndpointUrl,\n  studioEndpointUrl,\n  isLibrary,\n  placeholder,\n  initializeEditor,\n  openImgModal,\n  openSourceCodeModal,\n  setSelection,\n  updateContent,\n  minHeight,\n}) => {\n  const {\n    toolbar,\n    config,\n    plugins,\n    imageToolbar,\n    quickbarsInsertToolbar,\n    quickbarsSelectionToolbar,\n  } = pluginConfig({ isLibrary, placeholder, editorType });\n  return {\n    onInit: (evt, editor) => {\n      setEditorRef(editor);\n      if (editorType === 'text') {\n        initializeEditor();\n      }\n    },\n    initialValue: textValue || '',\n    init: {\n      ...config,\n      skin: false,\n      content_css: false,\n      content_style: tinyMCEStyles,\n      min_height: minHeight,\n      contextmenu: 'link table',\n      document_base_url: lmsEndpointUrl,\n      imagetools_cors_hosts: [removeProtocolFromUrl(lmsEndpointUrl), removeProtocolFromUrl(studioEndpointUrl)],\n      imagetools_toolbar: imageToolbar,\n      formats: { label: { inline: 'label' } },\n      setup: module.setupCustomBehavior({\n        editorType,\n        updateContent,\n        openImgModal,\n        openSourceCodeModal,\n        lmsEndpointUrl,\n        setImage: setSelection,\n        imageUrls: module.fetchImageUrls(images),\n      }),\n      quickbars_insert_toolbar: quickbarsInsertToolbar,\n      quickbars_selection_toolbar: quickbarsSelectionToolbar,\n      quickbars_image_toolbar: false,\n      toolbar,\n      plugins,\n      valid_children: '+body[style]',\n      valid_elements: '*[*]',\n      entity_encoding: 'utf-8',\n    },\n  };\n};\n\nexport const prepareEditorRef = () => {\n  const editorRef = useRef(null);\n  const setEditorRef = useCallback((ref) => {\n    editorRef.current = ref;\n  }, []);\n  const [refReady, setRefReady] = module.state.refReady(false);\n  useEffect(() => setRefReady(true), []);\n  return { editorRef, refReady, setEditorRef };\n};\n\nexport const imgModalToggle = () => {\n  const [isImgOpen, setIsOpen] = module.state.isImageModalOpen(false);\n  return {\n    isImgOpen,\n    openImgModal: () => setIsOpen(true),\n    closeImgModal: () => setIsOpen(false),\n  };\n};\n\nexport const sourceCodeModalToggle = (editorRef) => {\n  const [isSourceCodeOpen, setIsOpen] = module.state.isSourceCodeModalOpen(false);\n  return {\n    isSourceCodeOpen,\n    openSourceCodeModal: () => setIsOpen(true),\n    closeSourceCodeModal: () => {\n      setIsOpen(false);\n      editorRef.current.focus();\n    },\n  };\n};\n\nexport const openModalWithSelectedImage = ({ editor, setImage, openImgModal }) => () => {\n  const imgHTML = editor.selection.getNode();\n  setImage({\n    externalUrl: imgHTML.src,\n    altText: imgHTML.alt,\n    width: imgHTML.width,\n    height: imgHTML.height,\n  });\n  openImgModal();\n};\n\nexport const filterAssets = ({ assets }) => {\n  let images = [];\n  const assetsList = Object.values(assets);\n  if (assetsList.length > 0) {\n    images = assetsList.filter(asset => asset?.contentType?.startsWith('image/'));\n  }\n  return images;\n};\n\nexport const setAssetToStaticUrl = ({ editorValue, assets, lmsEndpointUrl }) => {\n  /* For assets to remain usable across course instances, we convert their url to be course-agnostic.\n   * For example, /assets/course/<asset hash>/filename gets converted to /static/filename. This is\n   * important for rerunning courses and importing/exporting course as the /static/ part of the url\n   * allows the asset to be mapped to the new course run.\n  */\n\n  // TODO: should probably move this to when the assets are being looped through in the off chance that\n  // some of the text in the editor contains the lmsEndpointUrl\n  const regExLmsEndpointUrl = RegExp(lmsEndpointUrl, 'g');\n  let content = editorValue.replace(regExLmsEndpointUrl, '');\n\n  const assetUrls = [];\n  const assetsList = Object.values(assets);\n  assetsList.forEach(asset => {\n    assetUrls.push({ portableUrl: asset.portableUrl, displayName: asset.displayName });\n  });\n  const assetSrcs = typeof content === 'string' ? content.split(/(src=\"|src=&quot;|href=\"|href=&quot)/g) : [];\n  assetSrcs.forEach(src => {\n    if (src.startsWith('/asset') && assetUrls.length > 0) {\n      const assetBlockName = src.substring(src.indexOf('@') + 1, src.search(/(\"|&quot;)/));\n      const nameFromEditorSrc = assetBlockName.substring(assetBlockName.indexOf('@') + 1);\n      const nameFromStudioSrc = assetBlockName.substring(assetBlockName.indexOf('/') + 1);\n      let portableUrl;\n      assetUrls.forEach((url) => {\n        const displayName = url.displayName.replace(/\\s/g, '_');\n        if (displayName === nameFromEditorSrc || displayName === nameFromStudioSrc) {\n          portableUrl = url.portableUrl;\n        }\n      });\n      if (portableUrl) {\n        const currentSrc = src.substring(0, src.search(/(\"|&quot;)/));\n        const updatedContent = content.replace(currentSrc, portableUrl);\n        content = updatedContent;\n      }\n    }\n  });\n  return content;\n};\n\nexport const fetchImageUrls = (images) => {\n  const imageUrls = [];\n  images.forEach(image => {\n    imageUrls.push({ staticFullUrl: image.staticFullUrl, displayName: image.displayName });\n  });\n  return imageUrls;\n};\n\nexport const selectedImage = (val) => {\n  const [selection, setSelection] = module.state.imageSelection(val);\n  return {\n    clearSelection: () => setSelection(null),\n    selection,\n    setSelection,\n  };\n};\n"],"mappings":"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"}