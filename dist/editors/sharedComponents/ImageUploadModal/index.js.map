{"version":3,"file":"index.js","names":["_react","_interopRequireDefault","require","_propTypes","_i18n","_tinyMCE","_ImageSettingsModal","_SelectImageModal","_module","_interopRequireWildcard","_jsxRuntime","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","propsString","props","keys","map","join","exports","imgProps","_ref","settings","selection","lmsEndpointUrl","editorType","url","externalUrl","startsWith","sourceEndIndex","length","substring","src","alt","isDecorative","altText","width","dimensions","height","hooks","createSaveCallback","_ref2","close","editorRef","setSelection","current","execCommand","tinyMCEKeys","commands","insertContent","module","imgTag","onClose","_ref3","clearSelection","_ref4","ImageUploadModal","_ref5","isOpen","images","jsx","saveToEditor","returnToSelection","defaultProps","propTypes","PropTypes","func","isRequired","oneOfType","shape","any","bool","string","_default","injectIntl"],"sources":["../../../../src/editors/sharedComponents/ImageUploadModal/index.jsx"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { injectIntl } from '@edx/frontend-platform/i18n';\nimport tinyMCEKeys from '../../data/constants/tinyMCE';\nimport ImageSettingsModal from './ImageSettingsModal';\nimport SelectImageModal from './SelectImageModal';\nimport * as module from '.';\n\nexport const propsString = (props) => (\n  Object.keys(props).map((key) => `${key}=\"${props[key]}\"`).join(' ')\n);\n\nexport const imgProps = ({\n  settings,\n  selection,\n  lmsEndpointUrl,\n  editorType,\n}) => {\n  let url = selection.externalUrl;\n  if (url.startsWith(lmsEndpointUrl) && editorType !== 'expandable') {\n    const sourceEndIndex = lmsEndpointUrl.length;\n    url = url.substring(sourceEndIndex);\n  }\n  return {\n    src: url,\n    alt: settings.isDecorative ? '' : settings.altText,\n    width: settings.dimensions.width,\n    height: settings.dimensions.height,\n  };\n};\n\nexport const hooks = {\n  createSaveCallback: ({\n    close,\n    editorRef,\n    editorType,\n    setSelection,\n    selection,\n    lmsEndpointUrl,\n  }) => (\n    settings,\n  ) => {\n    editorRef.current.execCommand(\n      tinyMCEKeys.commands.insertContent,\n      false,\n      module.hooks.imgTag({\n        settings,\n        selection,\n        lmsEndpointUrl,\n        editorType,\n      }),\n    );\n    setSelection(null);\n    close();\n  },\n  onClose: ({ clearSelection, close }) => () => {\n    clearSelection();\n    close();\n  },\n  imgTag: ({\n    settings,\n    selection,\n    lmsEndpointUrl,\n    editorType,\n  }) => {\n    const props = module.imgProps({\n      settings,\n      selection,\n      lmsEndpointUrl,\n      editorType,\n    });\n    return `<img ${propsString(props)} />`;\n  },\n};\n\nexport const ImageUploadModal = ({\n  // eslint-disable-next-line\n  editorRef,\n  isOpen,\n  close,\n  clearSelection,\n  selection,\n  setSelection,\n  images,\n  editorType,\n  lmsEndpointUrl,\n}) => {\n  if (selection) {\n    return (\n      <ImageSettingsModal\n        {...{\n          isOpen,\n          close: module.hooks.onClose({ clearSelection, close }),\n          selection,\n          saveToEditor: module.hooks.createSaveCallback({\n            close,\n            editorRef,\n            editorType,\n            selection,\n            setSelection,\n            lmsEndpointUrl,\n          }),\n          returnToSelection: clearSelection,\n        }}\n      />\n    );\n  }\n  return (\n    <SelectImageModal\n      {...{\n        isOpen,\n        close,\n        setSelection,\n        clearSelection,\n        images,\n      }}\n    />\n  );\n};\n\nImageUploadModal.defaultProps = {\n  editorRef: null,\n  editorType: null,\n  selection: null,\n};\nImageUploadModal.propTypes = {\n  clearSelection: PropTypes.func.isRequired,\n  close: PropTypes.func.isRequired,\n  editorRef: PropTypes.oneOfType([\n    PropTypes.func,\n    // eslint-disable-next-line react/forbid-prop-types\n    PropTypes.shape({ current: PropTypes.any }),\n  ]),\n  isOpen: PropTypes.bool.isRequired,\n  selection: PropTypes.shape({\n    url: PropTypes.string,\n    externalUrl: PropTypes.string,\n    altText: PropTypes.bool,\n  }),\n  setSelection: PropTypes.func.isRequired,\n  images: PropTypes.shape({}).isRequired,\n  lmsEndpointUrl: PropTypes.string.isRequired,\n  editorType: PropTypes.string,\n};\n\nexport default injectIntl(ImageUploadModal);\n"],"mappings":"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"}