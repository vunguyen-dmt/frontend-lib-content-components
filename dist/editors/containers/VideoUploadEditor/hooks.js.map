{"version":3,"file":"hooks.js","names":["requests","_interopRequireWildcard","require","_module","_redux","_store","_interopRequireDefault","appHooks","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","navigateTo","exports","uploadVideo","_ref","dispatch","supportedFiles","data","files","forEach","file","push","file_name","name","content_type","type","onFileUploadedHook","module","onFileUploaded","onSuccess","response","Promise","all","values","map","fileObj","fileName","edxVideoId","edx_video_id","uploadUrl","upload_url","uploadFile","find","console","error","formData","FormData","append","fetch","method","body","headers","then","catch","state","store","getState","learningContextId","selectors","app","blockId","onUrlUploaded","videoUrl","_default"],"sources":["../../../../src/editors/containers/VideoUploadEditor/hooks.js"],"sourcesContent":["import * as requests from '../../data/redux/thunkActions/requests';\nimport * as module from './hooks';\nimport { selectors } from '../../data/redux';\nimport store from '../../data/store';\nimport * as appHooks from '../../hooks';\n\nexport const {\n  navigateTo,\n} = appHooks;\n\nexport const uploadVideo = async ({ dispatch, supportedFiles }) => {\n  const data = { files: [] };\n  supportedFiles.forEach((file) => {\n    data.files.push({\n      file_name: file.name,\n      content_type: file.type,\n    });\n  });\n  const onFileUploadedHook = module.onFileUploaded();\n  dispatch(await requests.uploadVideo({\n    data,\n    onSuccess: async (response) => {\n      const { files } = response.data;\n      await Promise.all(Object.values(files).map(async (fileObj) => {\n        const fileName = fileObj.file_name;\n        const edxVideoId = fileObj.edx_video_id;\n        const uploadUrl = fileObj.upload_url;\n        const uploadFile = supportedFiles.find((file) => file.name === fileName);\n\n        if (!uploadFile) {\n          console.error(`Could not find file object with name \"${fileName}\" in supportedFiles array.`);\n          return;\n        }\n        const formData = new FormData();\n        formData.append('uploaded-file', uploadFile);\n        await fetch(uploadUrl, {\n          method: 'PUT',\n          body: formData,\n          headers: {\n            'Content-Type': 'multipart/form-data',\n          },\n        })\n          .then(() => onFileUploadedHook(edxVideoId))\n          .catch((error) => console.error('Error uploading file:', error));\n      }));\n    },\n  }));\n};\n\nexport const onFileUploaded = () => {\n  const state = store.getState();\n  const learningContextId = selectors.app.learningContextId(state);\n  const blockId = selectors.app.blockId(state);\n  return (edxVideoId) => navigateTo(`/course/${learningContextId}/editor/video/${blockId}?selectedVideoId=${edxVideoId}`);\n};\n\nexport const onUrlUploaded = () => {\n  const state = store.getState();\n  const learningContextId = selectors.app.learningContextId(state);\n  const blockId = selectors.app.blockId(state);\n  return (videoUrl) => navigateTo(`/course/${learningContextId}/editor/video/${blockId}?selectedVideoUrl=${videoUrl}`);\n};\n\nexport default {\n  uploadVideo,\n};\n"],"mappings":"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"}