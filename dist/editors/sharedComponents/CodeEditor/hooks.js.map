{"version":3,"file":"hooks.js","names":["_react","_interopRequireWildcard","require","_xmlchecker","_interopRequireDefault","_codemirror","_state","_view","_langHtml","_langXml","_lint","_constants","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","CODEMIRROR_LANGUAGES","HTML","XML","state","exports","showBtnEscapeHTML","val","React","useState","prepareShowBtnEscapeHTML","visibility","setVisibility","hide","hideBtn","cleanHTML","_ref","initialText","translateRegex","RegExp","keys","alphanumericMap","join","translator","$0","$1","replace","syntaxChecker","_ref2","textArr","lang","diagnostics","docString","xmlDoc","xmlChecker","check","error","errorStart","i","line","length","errorLine","errorEnd","push","from","to","severity","message","name","createCodeMirrorDomNode","_ref3","ref","upstreamRef","useEffect","languageExtension","html","xml","cleanText","newState","EditorState","create","doc","extensions","basicSetup","EditorView","lineWrapping","linter","view","text","parent","current","focus","destroy","escapeHTMLSpecialChars","_ref4","toString","pos","changes","forEach","escapedKeyword","next","indexOf","insert","dispatch"],"sources":["../../../../src/editors/sharedComponents/CodeEditor/hooks.js"],"sourcesContent":["import React, { useEffect } from 'react';\nimport xmlChecker from 'xmlchecker';\n\nimport { basicSetup } from 'codemirror';\nimport { EditorState } from '@codemirror/state';\nimport { EditorView } from '@codemirror/view';\nimport { html } from '@codemirror/lang-html';\nimport { xml } from '@codemirror/lang-xml';\nimport { linter } from '@codemirror/lint';\nimport alphanumericMap from './constants';\nimport './index.scss';\n\nconst CODEMIRROR_LANGUAGES = { HTML: 'html', XML: 'xml' };\n\nexport const state = {\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  showBtnEscapeHTML: (val) => React.useState(val),\n};\n\nexport const prepareShowBtnEscapeHTML = () => {\n  const [visibility, setVisibility] = state.showBtnEscapeHTML(true);\n  const hide = () => setVisibility(false);\n  return { showBtnEscapeHTML: visibility, hideBtn: hide };\n};\n\nexport const cleanHTML = ({ initialText }) => {\n  const translateRegex = new RegExp(`&(${Object.keys(alphanumericMap).join('|')});`, 'g');\n  const translator = ($0, $1) => alphanumericMap[$1];\n  return initialText.replace(translateRegex, translator);\n};\n\nexport const syntaxChecker = ({ textArr, lang }) => {\n  const diagnostics = [];\n  if (lang === 'xml' && textArr) {\n    const docString = textArr.join('\\n');\n    const xmlDoc = `<?xml version=\"1.0\" encoding=\"UTF-8\"?> ${docString}`;\n\n    try {\n      xmlChecker.check(xmlDoc);\n    } catch (error) {\n      let errorStart = 0;\n      for (let i = 0; i < error.line - 1; i++) {\n        errorStart += textArr[i].length;\n      }\n      const errorLine = error.line;\n      const errorEnd = errorStart + textArr[errorLine - 1].length;\n      diagnostics.push({\n        from: errorStart,\n        to: errorEnd,\n        severity: 'error',\n        message: `${error.name}: ${error.message}`,\n      });\n    }\n  }\n  return diagnostics;\n};\n\nexport const createCodeMirrorDomNode = ({\n  ref,\n  initialText,\n  upstreamRef,\n  lang,\n}) => {\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useEffect(() => {\n    const languageExtension = lang === CODEMIRROR_LANGUAGES.HTML ? html() : xml();\n    const cleanText = cleanHTML({ initialText });\n    const newState = EditorState.create({\n      doc: cleanText,\n      extensions: [\n        basicSetup,\n        languageExtension,\n        EditorView.lineWrapping,\n        linter((view) => {\n          const textArr = view.state.doc.text;\n          return syntaxChecker({ textArr, lang });\n        }),\n      ],\n    });\n    const view = new EditorView({ state: newState, parent: ref.current });\n    // eslint-disable-next-line no-param-reassign\n    upstreamRef.current = view;\n    view.focus();\n\n    return () => {\n      // called on cleanup\n      view.destroy();\n    };\n  }, []);\n};\n\nexport const escapeHTMLSpecialChars = ({ ref, hideBtn }) => {\n  const text = ref.current.state.doc.toString();\n  let pos = 0;\n  const changes = [];\n  Object.keys(alphanumericMap).forEach(\n    (escapedKeyword) => {\n      // eslint-disable-next-line no-cond-assign\n      for (let next; (next = text.indexOf(alphanumericMap[escapedKeyword], pos)) > -1;) {\n        changes.push({ from: next, to: next + 1, insert: `&${escapedKeyword};` });\n        pos = next + 1;\n      }\n    },\n  );\n\n  ref.current.dispatch({ changes });\n  hideBtn();\n};\n"],"mappings":"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"}