{"version":3,"file":"hooks.js","names":["_react","require","_tinyMCEStyles","_interopRequireDefault","_utils","_pluginConfig","_module","_interopRequireWildcard","_tinyMCE","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","TypeError","Number","state","StrictDict","isImageModalOpen","val","useState","isSourceCodeModalOpen","imageSelection","refReady","exports","addImagesAndDimensionsToRef","_ref","imagesRef","assets","editorContentHtml","imagesWithDimensions","module","filterAssets","map","image","imageFragment","getImageFromHtmlString","url","width","height","current","useImages","_ref2","useRef","useEffect","parseContentForLabels","_ref3","editor","updateContent","content","getContent","parsedLabels","split","updatedContent","label","startsWith","endsWith","previousLabel","nextLabel","replace","replaceStaticwithAsset","_ref4","imageUrls","editorType","lmsEndpointUrl","imageSrcs","src","currentContent","staticFullUrl","isStatic","isExpandableAsset","assetSrc","substring","indexOf","assetName","staticName","displayName","currentSrc","setContent","getImageResizeHandler","_ref5","setImage","alt","selection","getNode","updateImageDimensions","images","result","externalUrl","altText","setupCustomBehavior","_ref6","openImgModal","openSourceCodeModal","ui","registry","addButton","tinyMCE","buttons","imageUploadButton","icon","tooltip","onAction","editImageSettings","openModalWithSelectedImage","code","text","setupCodeFormatting","api","formatter","formatChanged","active","setActive","toggleCodeFormatting","toggle","undoManager","add","focus","addToggleButton","codeBlock","onSetup","toggleLabelFormatting","execCommand","addIcon","textToSpeechIcon","on","e","command","remove","removeProtocolFromUrl","editorConfig","_ref7","setEditorRef","studioEndpointUrl","isLibrary","placeholder","initializeEditor","setSelection","minHeight","toolbar","config","plugins","imageToolbar","quickbarsInsertToolbar","quickbarsSelectionToolbar","pluginConfig","onInit","evt","initialValue","init","skin","content_css","content_style","tinyMCEStyles","min_height","contextmenu","document_base_url","imagetools_cors_hosts","imagetools_toolbar","formats","inline","setup","fetchImageUrls","quickbars_insert_toolbar","quickbars_selection_toolbar","quickbars_image_toolbar","valid_children","valid_elements","entity_encoding","prepareEditorRef","editorRef","useCallback","ref","setRefReady","imgModalToggle","isImgOpen","setIsOpen","closeImgModal","sourceCodeModalToggle","isSourceCodeOpen","closeSourceCodeModal","imageMatchRegex","matchImageStringsByIdentifiers","a","b","matchA","JSON","stringify","match","slice","matchB","stringToFragment","htmlString","document","createRange","createContextualFragment","imageSrc","querySelectorAll","Array","from","find","img","detectImageMatchingError","_ref8","matchingImages","tinyMceHTML","id","_ref9","mceSrc","imageMatchingErrorDetected","_ref10","assetsList","values","asset","contentType","setAssetToStaticUrl","_ref11","editorValue","regExLmsEndpointUrl","RegExp","assetUrls","portableUrl","assetSrcs","assetBlockName","search","nameFromEditorSrc","nameFromStudioSrc","selectedImage","clearSelection","_ref12","foundMatch","imageIdentifier","isMatch"],"sources":["../../../../src/editors/sharedComponents/TinyMceWidget/hooks.js"],"sourcesContent":["import {\n  useState,\n  useRef,\n  useCallback,\n  useEffect,\n} from 'react';\nimport tinyMCEStyles from '../../data/constants/tinyMCEStyles';\nimport { StrictDict } from '../../utils';\nimport pluginConfig from './pluginConfig';\nimport * as module from './hooks';\nimport tinyMCE from '../../data/constants/tinyMCE';\n\nexport const state = StrictDict({\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  isImageModalOpen: (val) => useState(val),\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  isSourceCodeModalOpen: (val) => useState(val),\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  imageSelection: (val) => useState(val),\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  refReady: (val) => useState(val),\n});\n\nexport const addImagesAndDimensionsToRef = ({ imagesRef, assets, editorContentHtml }) => {\n  const imagesWithDimensions = module.filterAssets({ assets }).map((image) => {\n    const imageFragment = module.getImageFromHtmlString(editorContentHtml, image.url);\n    return { ...image, width: imageFragment?.width, height: imageFragment?.height };\n  });\n\n  imagesRef.current = imagesWithDimensions;\n};\n\nexport const useImages = ({ assets, editorContentHtml }) => {\n  const imagesRef = useRef([]);\n\n  useEffect(() => {\n    module.addImagesAndDimensionsToRef({ imagesRef, assets, editorContentHtml });\n  }, []);\n\n  return { imagesRef };\n};\n\nexport const parseContentForLabels = ({ editor, updateContent }) => {\n  let content = editor.getContent();\n  if (content && content?.length > 0) {\n    const parsedLabels = content.split(/<label>|<\\/label>/gm);\n    let updatedContent;\n    parsedLabels.forEach((label, i) => {\n      if (!label.startsWith('<') && !label.endsWith('>')) {\n        let previousLabel = parsedLabels[i - 1];\n        let nextLabel = parsedLabels[i + 1];\n        if (!previousLabel.endsWith('<p>')) {\n          previousLabel = `${previousLabel}</p><p>`;\n          updatedContent = content.replace(parsedLabels[i - 1], previousLabel);\n          content = updatedContent;\n          updateContent(content);\n        }\n        if (!nextLabel.startsWith('</p>')) {\n          nextLabel = `</p><p>${nextLabel}`;\n          updatedContent = content.replace(parsedLabels[i + 1], nextLabel);\n          content = updatedContent;\n          updateContent(content);\n        }\n      }\n    });\n  } else {\n    updateContent(content);\n  }\n};\n\nexport const replaceStaticwithAsset = ({\n  editor,\n  imageUrls,\n  editorType,\n  lmsEndpointUrl,\n  updateContent,\n}) => {\n  let content = editor.getContent();\n  const imageSrcs = content.split('src=\"');\n  imageSrcs.forEach(src => {\n    const currentContent = content;\n    let staticFullUrl;\n    const isStatic = src.startsWith('/static/');\n    const isExpandableAsset = src.startsWith('/assets/') && editorType === 'expandable';\n    if ((isStatic || isExpandableAsset) && imageUrls.length > 0) {\n      const assetSrc = src.substring(0, src.indexOf('\"'));\n      const assetName = assetSrc.replace(/\\/assets\\/.+[^/]\\//g, '');\n      const staticName = assetSrc.substring(8);\n      imageUrls.forEach((url) => {\n        if (isExpandableAsset && assetName === url.displayName) {\n          staticFullUrl = `${lmsEndpointUrl}${url.staticFullUrl}`;\n        } else if (staticName === url.displayName) {\n          staticFullUrl = url.staticFullUrl;\n          if (isExpandableAsset) {\n            staticFullUrl = `${lmsEndpointUrl}${url.staticFullUrl}`;\n          }\n        }\n      });\n      if (staticFullUrl) {\n        const currentSrc = src.substring(0, src.indexOf('\"'));\n        content = currentContent.replace(currentSrc, staticFullUrl);\n        if (editorType === 'expandable') {\n          updateContent(content);\n        } else {\n          editor.setContent(content);\n        }\n      }\n    }\n  });\n};\n\nexport const getImageResizeHandler = ({ editor, imagesRef, setImage }) => () => {\n  const {\n    src, alt, width, height,\n  } = editor.selection.getNode();\n\n  imagesRef.current = module.updateImageDimensions({\n    images: imagesRef.current, url: src, width, height,\n  }).result;\n\n  setImage({\n    externalUrl: src,\n    altText: alt,\n    width,\n    height,\n  });\n};\n\nexport const setupCustomBehavior = ({\n  updateContent,\n  openImgModal,\n  openSourceCodeModal,\n  editorType,\n  imageUrls,\n  images,\n  setImage,\n  lmsEndpointUrl,\n}) => (editor) => {\n  // image upload button\n  editor.ui.registry.addButton(tinyMCE.buttons.imageUploadButton, {\n    icon: 'image',\n    tooltip: 'Add Image',\n    onAction: openImgModal,\n  });\n  // editing an existing image\n  editor.ui.registry.addButton(tinyMCE.buttons.editImageSettings, {\n    icon: 'image',\n    tooltip: 'Edit Image Settings',\n    onAction: module.openModalWithSelectedImage({\n      editor, images, setImage, openImgModal,\n    }),\n  });\n  // overriding the code plugin's icon with 'HTML' text\n  editor.ui.registry.addButton(tinyMCE.buttons.code, {\n    text: 'HTML',\n    tooltip: 'Source code',\n    onAction: openSourceCodeModal,\n  });\n  // add a custom simple inline code block formatter.\n  const setupCodeFormatting = (api) => {\n    editor.formatter.formatChanged(\n      'code',\n      (active) => api.setActive(active),\n    );\n  };\n  const toggleCodeFormatting = () => {\n    editor.formatter.toggle('code');\n    editor.undoManager.add();\n    editor.focus();\n  };\n  editor.ui.registry.addToggleButton(tinyMCE.buttons.codeBlock, {\n    icon: 'sourcecode',\n    tooltip: 'Code Block',\n    onAction: toggleCodeFormatting,\n    onSetup: setupCodeFormatting,\n  });\n  // add a custom simple inline label formatter.\n  const toggleLabelFormatting = () => {\n    editor.execCommand('mceToggleFormat', false, 'label');\n  };\n  editor.ui.registry.addIcon('textToSpeech', tinyMCE.textToSpeechIcon);\n  editor.ui.registry.addButton('customLabelButton', {\n    icon: 'textToSpeech',\n    text: 'Label',\n    tooltip: 'Apply a \"Question\" label to specific text, recognized by screen readers. Recommended to improve accessibility.',\n    onAction: toggleLabelFormatting,\n  });\n  if (editorType === 'expandable') {\n    editor.on('init', () => {\n      module.replaceStaticwithAsset({\n        editor,\n        imageUrls,\n        editorType,\n        lmsEndpointUrl,\n        updateContent,\n      });\n    });\n  }\n  editor.on('ExecCommand', (e) => {\n    if (editorType === 'text' && e.command === 'mceFocus') {\n      module.replaceStaticwithAsset({ editor, imageUrls });\n    }\n    if (e.command === 'RemoveFormat') {\n      editor.formatter.remove('blockquote');\n      editor.formatter.remove('label');\n    }\n  });\n  // after resizing an image in the editor, synchronize React state and ref\n  editor.on('ObjectResized', getImageResizeHandler({ editor, imagesRef: images, setImage }));\n};\n\n// imagetools_cors_hosts needs a protocol-sanatized url\nexport const removeProtocolFromUrl = (url) => url.replace(/^https?:\\/\\//, '');\n\nexport const editorConfig = ({\n  editorType,\n  setEditorRef,\n  editorContentHtml,\n  images,\n  lmsEndpointUrl,\n  studioEndpointUrl,\n  isLibrary,\n  placeholder,\n  initializeEditor,\n  openImgModal,\n  openSourceCodeModal,\n  setSelection,\n  updateContent,\n  content,\n  minHeight,\n}) => {\n  const {\n    toolbar,\n    config,\n    plugins,\n    imageToolbar,\n    quickbarsInsertToolbar,\n    quickbarsSelectionToolbar,\n  } = pluginConfig({ isLibrary, placeholder, editorType });\n\n  return {\n    onInit: (evt, editor) => {\n      setEditorRef(editor);\n      if (editorType === 'text') {\n        initializeEditor();\n      }\n    },\n    initialValue: editorContentHtml || '',\n    init: {\n      ...config,\n      skin: false,\n      content_css: false,\n      content_style: tinyMCEStyles,\n      min_height: minHeight,\n      contextmenu: 'link table',\n      document_base_url: lmsEndpointUrl,\n      imagetools_cors_hosts: [removeProtocolFromUrl(lmsEndpointUrl), removeProtocolFromUrl(studioEndpointUrl)],\n      imagetools_toolbar: imageToolbar,\n      formats: { label: { inline: 'label' } },\n      setup: module.setupCustomBehavior({\n        editorType,\n        updateContent,\n        openImgModal,\n        openSourceCodeModal,\n        lmsEndpointUrl,\n        setImage: setSelection,\n        content,\n        images,\n        imageUrls: module.fetchImageUrls(images),\n      }),\n      quickbars_insert_toolbar: quickbarsInsertToolbar,\n      quickbars_selection_toolbar: quickbarsSelectionToolbar,\n      quickbars_image_toolbar: false,\n      toolbar,\n      plugins,\n      valid_children: '+body[style]',\n      valid_elements: '*[*]',\n      entity_encoding: 'utf-8',\n    },\n  };\n};\n\nexport const prepareEditorRef = () => {\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const editorRef = useRef(null);\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const setEditorRef = useCallback((ref) => {\n    editorRef.current = ref;\n  }, []);\n  const [refReady, setRefReady] = module.state.refReady(false);\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useEffect(() => setRefReady(true), []);\n  return { editorRef, refReady, setEditorRef };\n};\n\nexport const imgModalToggle = () => {\n  const [isImgOpen, setIsOpen] = module.state.isImageModalOpen(false);\n  return {\n    isImgOpen,\n    openImgModal: () => setIsOpen(true),\n    closeImgModal: () => setIsOpen(false),\n  };\n};\n\nexport const sourceCodeModalToggle = (editorRef) => {\n  const [isSourceCodeOpen, setIsOpen] = module.state.isSourceCodeModalOpen(false);\n  return {\n    isSourceCodeOpen,\n    openSourceCodeModal: () => setIsOpen(true),\n    closeSourceCodeModal: () => {\n      setIsOpen(false);\n      editorRef.current.focus();\n    },\n  };\n};\n\n/**\n * const imageMatchRegex\n *\n * Image urls and ids used in the TinyMceEditor vary wildly, with different base urls,\n * different lengths and constituent parts, and replacement of some \"/\" with \"@\".\n * Common are the keys \"asset-v1\", \"type\", and \"block\", each holding a value after some separator.\n * This regex captures only the values for these keys using capture groups, which can be used for matching.\n */\nexport const imageMatchRegex = /asset-v1.(.*).type.(.*).block.(.*)/;\n\n/**\n * function matchImageStringsByIdentifiers\n *\n * matches two strings by comparing their regex capture groups using the `imageMatchRegex`\n */\nexport const matchImageStringsByIdentifiers = (a, b) => {\n  if (!a || !b || !(typeof a === 'string') || !(typeof b === 'string')) { return null; }\n  const matchA = JSON.stringify(a.match(imageMatchRegex)?.slice?.(1));\n  const matchB = JSON.stringify(b.match(imageMatchRegex)?.slice?.(1));\n  return matchA && matchA === matchB;\n};\n\nexport const stringToFragment = (htmlString) => document.createRange().createContextualFragment(htmlString);\n\nexport const getImageFromHtmlString = (htmlString, imageSrc) => {\n  const images = stringToFragment(htmlString)?.querySelectorAll('img') || [];\n\n  return Array.from(images).find((img) => matchImageStringsByIdentifiers(img.src || '', imageSrc));\n};\n\nexport const detectImageMatchingError = ({ matchingImages, tinyMceHTML }) => {\n  if (!matchingImages.length) { return true; }\n  if (matchingImages.length > 1) { return true; }\n\n  if (!matchImageStringsByIdentifiers(matchingImages[0].id, tinyMceHTML.src)) { return true; }\n  if (!matchingImages[0].width || !matchingImages[0].height) { return true; }\n  if (matchingImages[0].width !== tinyMceHTML.width) { return true; }\n  if (matchingImages[0].height !== tinyMceHTML.height) { return true; }\n\n  return false;\n};\n\nexport const openModalWithSelectedImage = ({\n  editor, images, setImage, openImgModal,\n}) => () => {\n  const tinyMceHTML = editor.selection.getNode();\n  const { src: mceSrc } = tinyMceHTML;\n\n  const matchingImages = images.current.filter(image => matchImageStringsByIdentifiers(image.id, mceSrc));\n\n  const imageMatchingErrorDetected = detectImageMatchingError({ tinyMceHTML, matchingImages });\n\n  const width = imageMatchingErrorDetected ? null : matchingImages[0]?.width;\n  const height = imageMatchingErrorDetected ? null : matchingImages[0]?.height;\n\n  setImage({\n    externalUrl: tinyMceHTML.src,\n    altText: tinyMceHTML.alt,\n    width,\n    height,\n  });\n\n  openImgModal();\n};\n\nexport const filterAssets = ({ assets }) => {\n  let images = [];\n  const assetsList = Object.values(assets);\n  if (assetsList.length > 0) {\n    images = assetsList.filter(asset => asset?.contentType?.startsWith('image/'));\n  }\n  return images;\n};\n\nexport const setAssetToStaticUrl = ({ editorValue, assets, lmsEndpointUrl }) => {\n  /* For assets to remain usable across course instances, we convert their url to be course-agnostic.\n   * For example, /assets/course/<asset hash>/filename gets converted to /static/filename. This is\n   * important for rerunning courses and importing/exporting course as the /static/ part of the url\n   * allows the asset to be mapped to the new course run.\n  */\n\n  // TODO: should probably move this to when the assets are being looped through in the off chance that\n  // some of the text in the editor contains the lmsEndpointUrl\n  const regExLmsEndpointUrl = RegExp(lmsEndpointUrl, 'g');\n  let content = editorValue.replace(regExLmsEndpointUrl, '');\n\n  const assetUrls = [];\n  const assetsList = Object.values(assets);\n  assetsList.forEach(asset => {\n    assetUrls.push({ portableUrl: asset.portableUrl, displayName: asset.displayName });\n  });\n  const assetSrcs = typeof content === 'string' ? content.split(/(src=\"|src=&quot;|href=\"|href=&quot)/g) : [];\n  assetSrcs.forEach(src => {\n    if (src.startsWith('/asset') && assetUrls.length > 0) {\n      const assetBlockName = src.substring(src.indexOf('@') + 1, src.search(/(\"|&quot;)/));\n      const nameFromEditorSrc = assetBlockName.substring(assetBlockName.indexOf('@') + 1);\n      const nameFromStudioSrc = assetBlockName.substring(assetBlockName.indexOf('/') + 1);\n      let portableUrl;\n      assetUrls.forEach((url) => {\n        const displayName = url.displayName.replace(/\\s/g, '_');\n        if (displayName === nameFromEditorSrc || displayName === nameFromStudioSrc) {\n          portableUrl = url.portableUrl;\n        }\n      });\n      if (portableUrl) {\n        const currentSrc = src.substring(0, src.search(/(\"|&quot;)/));\n        const updatedContent = content.replace(currentSrc, portableUrl);\n        content = updatedContent;\n      }\n    }\n  });\n  return content;\n};\n\nexport const fetchImageUrls = (images) => {\n  const imageUrls = [];\n  images.current.forEach(image => {\n    imageUrls.push({ staticFullUrl: image.staticFullUrl, displayName: image.displayName });\n  });\n  return imageUrls;\n};\n\nexport const selectedImage = (val) => {\n  const [selection, setSelection] = module.state.imageSelection(val);\n  return {\n    clearSelection: () => setSelection(null),\n    selection,\n    setSelection,\n  };\n};\n\n/**\n * function updateImageDimensions\n *\n * Updates one images' dimensions in an array by identifying one image via a url string match\n * that includes asset-v1, type, and block. Returns a new array.\n *\n * @param {Object[]} images - [{ id, ...other }]\n * @param {string} url\n * @param {number} width\n * @param {number} height\n *\n * @returns {Object} { result, foundMatch }\n */\nexport const updateImageDimensions = ({\n  images, url, width, height,\n}) => {\n  let foundMatch = false;\n\n  const result = images.map((image) => {\n    const imageIdentifier = image.id || image.url || image.src || image.externalUrl;\n    const isMatch = matchImageStringsByIdentifiers(imageIdentifier, url);\n    if (isMatch) {\n      foundMatch = true;\n      return { ...image, width, height };\n    }\n    return image;\n  });\n\n  return { result, foundMatch };\n};\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAMA,IAAAC,cAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,MAAA,GAAAH,OAAA;AACA,IAAAI,aAAA,GAAAF,sBAAA,CAAAF,OAAA;AACA,IAAAK,OAAA,GAAAC,uBAAA,CAAAN,OAAA;AACA,IAAAO,QAAA,GAAAL,sBAAA,CAAAF,OAAA;AAAmD,SAAAQ,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAH,wBAAAO,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAAA,SAAAjB,uBAAAW,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAAA,SAAAiB,QAAAC,MAAA,EAAAC,cAAA,QAAAC,IAAA,GAAAZ,MAAA,CAAAY,IAAA,CAAAF,MAAA,OAAAV,MAAA,CAAAa,qBAAA,QAAAC,OAAA,GAAAd,MAAA,CAAAa,qBAAA,CAAAH,MAAA,GAAAC,cAAA,KAAAG,OAAA,GAAAA,OAAA,CAAAC,MAAA,WAAAC,GAAA,WAAAhB,MAAA,CAAAE,wBAAA,CAAAQ,MAAA,EAAAM,GAAA,EAAAC,UAAA,OAAAL,IAAA,CAAAM,IAAA,CAAAC,KAAA,CAAAP,IAAA,EAAAE,OAAA,YAAAF,IAAA;AAAA,SAAAQ,cAAAC,MAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAF,CAAA,UAAAG,MAAA,WAAAF,SAAA,CAAAD,CAAA,IAAAC,SAAA,CAAAD,CAAA,QAAAA,CAAA,OAAAb,OAAA,CAAAT,MAAA,CAAAyB,MAAA,OAAAC,OAAA,WAAAvB,GAAA,IAAAwB,eAAA,CAAAN,MAAA,EAAAlB,GAAA,EAAAsB,MAAA,CAAAtB,GAAA,SAAAH,MAAA,CAAA4B,yBAAA,GAAA5B,MAAA,CAAA6B,gBAAA,CAAAR,MAAA,EAAArB,MAAA,CAAA4B,yBAAA,CAAAH,MAAA,KAAAhB,OAAA,CAAAT,MAAA,CAAAyB,MAAA,GAAAC,OAAA,WAAAvB,GAAA,IAAAH,MAAA,CAAAC,cAAA,CAAAoB,MAAA,EAAAlB,GAAA,EAAAH,MAAA,CAAAE,wBAAA,CAAAuB,MAAA,EAAAtB,GAAA,iBAAAkB,MAAA;AAAA,SAAAM,gBAAAnC,GAAA,EAAAW,GAAA,EAAA2B,KAAA,IAAA3B,GAAA,GAAA4B,cAAA,CAAA5B,GAAA,OAAAA,GAAA,IAAAX,GAAA,IAAAQ,MAAA,CAAAC,cAAA,CAAAT,GAAA,EAAAW,GAAA,IAAA2B,KAAA,EAAAA,KAAA,EAAAb,UAAA,QAAAe,YAAA,QAAAC,QAAA,oBAAAzC,GAAA,CAAAW,GAAA,IAAA2B,KAAA,WAAAtC,GAAA;AAAA,SAAAuC,eAAAG,GAAA,QAAA/B,GAAA,GAAAgC,YAAA,CAAAD,GAAA,2BAAA/B,GAAA,gBAAAA,GAAA,GAAAiC,MAAA,CAAAjC,GAAA;AAAA,SAAAgC,aAAAE,KAAA,EAAAC,IAAA,eAAAD,KAAA,iBAAAA,KAAA,kBAAAA,KAAA,MAAAE,IAAA,GAAAF,KAAA,CAAAG,MAAA,CAAAC,WAAA,OAAAF,IAAA,KAAAG,SAAA,QAAAC,GAAA,GAAAJ,IAAA,CAAAjC,IAAA,CAAA+B,KAAA,EAAAC,IAAA,2BAAAK,GAAA,sBAAAA,GAAA,YAAAC,SAAA,4DAAAN,IAAA,gBAAAF,MAAA,GAAAS,MAAA,EAAAR,KAAA;AAE5C,MAAMS,KAAK,GAAG,IAAAC,iBAAU,EAAC;EAC9B;EACAC,gBAAgB,EAAGC,GAAG,IAAK,IAAAC,eAAQ,EAACD,GAAG,CAAC;EACxC;EACAE,qBAAqB,EAAGF,GAAG,IAAK,IAAAC,eAAQ,EAACD,GAAG,CAAC;EAC7C;EACAG,cAAc,EAAGH,GAAG,IAAK,IAAAC,eAAQ,EAACD,GAAG,CAAC;EACtC;EACAI,QAAQ,EAAGJ,GAAG,IAAK,IAAAC,eAAQ,EAACD,GAAG;AACjC,CAAC,CAAC;AAACK,OAAA,CAAAR,KAAA,GAAAA,KAAA;AAEI,MAAMS,2BAA2B,GAAGC,IAAA,IAA8C;EAAA,IAA7C;IAAEC,SAAS;IAAEC,MAAM;IAAEC;EAAkB,CAAC,GAAAH,IAAA;EAClF,MAAMI,oBAAoB,GAAGC,OAAM,CAACC,YAAY,CAAC;IAAEJ;EAAO,CAAC,CAAC,CAACK,GAAG,CAAEC,KAAK,IAAK;IAC1E,MAAMC,aAAa,GAAGJ,OAAM,CAACK,sBAAsB,CAACP,iBAAiB,EAAEK,KAAK,CAACG,GAAG,CAAC;IACjF,OAAA/C,aAAA,CAAAA,aAAA,KAAY4C,KAAK;MAAEI,KAAK,EAAEH,aAAa,EAAEG,KAAK;MAAEC,MAAM,EAAEJ,aAAa,EAAEI;IAAM;EAC/E,CAAC,CAAC;EAEFZ,SAAS,CAACa,OAAO,GAAGV,oBAAoB;AAC1C,CAAC;AAACN,OAAA,CAAAC,2BAAA,GAAAA,2BAAA;AAEK,MAAMgB,SAAS,GAAGC,KAAA,IAAmC;EAAA,IAAlC;IAAEd,MAAM;IAAEC;EAAkB,CAAC,GAAAa,KAAA;EACrD,MAAMf,SAAS,GAAG,IAAAgB,aAAM,EAAC,EAAE,CAAC;EAE5B,IAAAC,gBAAS,EAAC,MAAM;IACdb,OAAM,CAACN,2BAA2B,CAAC;MAAEE,SAAS;MAAEC,MAAM;MAAEC;IAAkB,CAAC,CAAC;EAC9E,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IAAEF;EAAU,CAAC;AACtB,CAAC;AAACH,OAAA,CAAAiB,SAAA,GAAAA,SAAA;AAEK,MAAMI,qBAAqB,GAAGC,KAAA,IAA+B;EAAA,IAA9B;IAAEC,MAAM;IAAEC;EAAc,CAAC,GAAAF,KAAA;EAC7D,IAAIG,OAAO,GAAGF,MAAM,CAACG,UAAU,CAAC,CAAC;EACjC,IAAID,OAAO,IAAIA,OAAO,EAAEvD,MAAM,GAAG,CAAC,EAAE;IAClC,MAAMyD,YAAY,GAAGF,OAAO,CAACG,KAAK,CAAC,qBAAqB,CAAC;IACzD,IAAIC,cAAc;IAClBF,YAAY,CAACvD,OAAO,CAAC,CAAC0D,KAAK,EAAE9D,CAAC,KAAK;MACjC,IAAI,CAAC8D,KAAK,CAACC,UAAU,CAAC,GAAG,CAAC,IAAI,CAACD,KAAK,CAACE,QAAQ,CAAC,GAAG,CAAC,EAAE;QAClD,IAAIC,aAAa,GAAGN,YAAY,CAAC3D,CAAC,GAAG,CAAC,CAAC;QACvC,IAAIkE,SAAS,GAAGP,YAAY,CAAC3D,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,CAACiE,aAAa,CAACD,QAAQ,CAAC,KAAK,CAAC,EAAE;UAClCC,aAAa,GAAI,GAAEA,aAAc,SAAQ;UACzCJ,cAAc,GAAGJ,OAAO,CAACU,OAAO,CAACR,YAAY,CAAC3D,CAAC,GAAG,CAAC,CAAC,EAAEiE,aAAa,CAAC;UACpER,OAAO,GAAGI,cAAc;UACxBL,aAAa,CAACC,OAAO,CAAC;QACxB;QACA,IAAI,CAACS,SAAS,CAACH,UAAU,CAAC,MAAM,CAAC,EAAE;UACjCG,SAAS,GAAI,UAASA,SAAU,EAAC;UACjCL,cAAc,GAAGJ,OAAO,CAACU,OAAO,CAACR,YAAY,CAAC3D,CAAC,GAAG,CAAC,CAAC,EAAEkE,SAAS,CAAC;UAChET,OAAO,GAAGI,cAAc;UACxBL,aAAa,CAACC,OAAO,CAAC;QACxB;MACF;IACF,CAAC,CAAC;EACJ,CAAC,MAAM;IACLD,aAAa,CAACC,OAAO,CAAC;EACxB;AACF,CAAC;AAACzB,OAAA,CAAAqB,qBAAA,GAAAA,qBAAA;AAEK,MAAMe,sBAAsB,GAAGC,KAAA,IAMhC;EAAA,IANiC;IACrCd,MAAM;IACNe,SAAS;IACTC,UAAU;IACVC,cAAc;IACdhB;EACF,CAAC,GAAAa,KAAA;EACC,IAAIZ,OAAO,GAAGF,MAAM,CAACG,UAAU,CAAC,CAAC;EACjC,MAAMe,SAAS,GAAGhB,OAAO,CAACG,KAAK,CAAC,OAAO,CAAC;EACxCa,SAAS,CAACrE,OAAO,CAACsE,GAAG,IAAI;IACvB,MAAMC,cAAc,GAAGlB,OAAO;IAC9B,IAAImB,aAAa;IACjB,MAAMC,QAAQ,GAAGH,GAAG,CAACX,UAAU,CAAC,UAAU,CAAC;IAC3C,MAAMe,iBAAiB,GAAGJ,GAAG,CAACX,UAAU,CAAC,UAAU,CAAC,IAAIQ,UAAU,KAAK,YAAY;IACnF,IAAI,CAACM,QAAQ,IAAIC,iBAAiB,KAAKR,SAAS,CAACpE,MAAM,GAAG,CAAC,EAAE;MAC3D,MAAM6E,QAAQ,GAAGL,GAAG,CAACM,SAAS,CAAC,CAAC,EAAEN,GAAG,CAACO,OAAO,CAAC,GAAG,CAAC,CAAC;MACnD,MAAMC,SAAS,GAAGH,QAAQ,CAACZ,OAAO,CAAC,qBAAqB,EAAE,EAAE,CAAC;MAC7D,MAAMgB,UAAU,GAAGJ,QAAQ,CAACC,SAAS,CAAC,CAAC,CAAC;MACxCV,SAAS,CAAClE,OAAO,CAAEyC,GAAG,IAAK;QACzB,IAAIiC,iBAAiB,IAAII,SAAS,KAAKrC,GAAG,CAACuC,WAAW,EAAE;UACtDR,aAAa,GAAI,GAAEJ,cAAe,GAAE3B,GAAG,CAAC+B,aAAc,EAAC;QACzD,CAAC,MAAM,IAAIO,UAAU,KAAKtC,GAAG,CAACuC,WAAW,EAAE;UACzCR,aAAa,GAAG/B,GAAG,CAAC+B,aAAa;UACjC,IAAIE,iBAAiB,EAAE;YACrBF,aAAa,GAAI,GAAEJ,cAAe,GAAE3B,GAAG,CAAC+B,aAAc,EAAC;UACzD;QACF;MACF,CAAC,CAAC;MACF,IAAIA,aAAa,EAAE;QACjB,MAAMS,UAAU,GAAGX,GAAG,CAACM,SAAS,CAAC,CAAC,EAAEN,GAAG,CAACO,OAAO,CAAC,GAAG,CAAC,CAAC;QACrDxB,OAAO,GAAGkB,cAAc,CAACR,OAAO,CAACkB,UAAU,EAAET,aAAa,CAAC;QAC3D,IAAIL,UAAU,KAAK,YAAY,EAAE;UAC/Bf,aAAa,CAACC,OAAO,CAAC;QACxB,CAAC,MAAM;UACLF,MAAM,CAAC+B,UAAU,CAAC7B,OAAO,CAAC;QAC5B;MACF;IACF;EACF,CAAC,CAAC;AACJ,CAAC;AAACzB,OAAA,CAAAoC,sBAAA,GAAAA,sBAAA;AAEK,MAAMmB,qBAAqB,GAAGC,KAAA;EAAA,IAAC;IAAEjC,MAAM;IAAEpB,SAAS;IAAEsD;EAAS,CAAC,GAAAD,KAAA;EAAA,OAAK,MAAM;IAC9E,MAAM;MACJd,GAAG;MAAEgB,GAAG;MAAE5C,KAAK;MAAEC;IACnB,CAAC,GAAGQ,MAAM,CAACoC,SAAS,CAACC,OAAO,CAAC,CAAC;IAE9BzD,SAAS,CAACa,OAAO,GAAGT,OAAM,CAACsD,qBAAqB,CAAC;MAC/CC,MAAM,EAAE3D,SAAS,CAACa,OAAO;MAAEH,GAAG,EAAE6B,GAAG;MAAE5B,KAAK;MAAEC;IAC9C,CAAC,CAAC,CAACgD,MAAM;IAETN,QAAQ,CAAC;MACPO,WAAW,EAAEtB,GAAG;MAChBuB,OAAO,EAAEP,GAAG;MACZ5C,KAAK;MACLC;IACF,CAAC,CAAC;EACJ,CAAC;AAAA;AAACf,OAAA,CAAAuD,qBAAA,GAAAA,qBAAA;AAEK,MAAMW,mBAAmB,GAAGC,KAAA;EAAA,IAAC;IAClC3C,aAAa;IACb4C,YAAY;IACZC,mBAAmB;IACnB9B,UAAU;IACVD,SAAS;IACTwB,MAAM;IACNL,QAAQ;IACRjB;EACF,CAAC,GAAA2B,KAAA;EAAA,OAAM5C,MAAM,IAAK;IAChB;IACAA,MAAM,CAAC+C,EAAE,CAACC,QAAQ,CAACC,SAAS,CAACC,gBAAO,CAACC,OAAO,CAACC,iBAAiB,EAAE;MAC9DC,IAAI,EAAE,OAAO;MACbC,OAAO,EAAE,WAAW;MACpBC,QAAQ,EAAEV;IACZ,CAAC,CAAC;IACF;IACA7C,MAAM,CAAC+C,EAAE,CAACC,QAAQ,CAACC,SAAS,CAACC,gBAAO,CAACC,OAAO,CAACK,iBAAiB,EAAE;MAC9DH,IAAI,EAAE,OAAO;MACbC,OAAO,EAAE,qBAAqB;MAC9BC,QAAQ,EAAEvE,OAAM,CAACyE,0BAA0B,CAAC;QAC1CzD,MAAM;QAAEuC,MAAM;QAAEL,QAAQ;QAAEW;MAC5B,CAAC;IACH,CAAC,CAAC;IACF;IACA7C,MAAM,CAAC+C,EAAE,CAACC,QAAQ,CAACC,SAAS,CAACC,gBAAO,CAACC,OAAO,CAACO,IAAI,EAAE;MACjDC,IAAI,EAAE,MAAM;MACZL,OAAO,EAAE,aAAa;MACtBC,QAAQ,EAAET;IACZ,CAAC,CAAC;IACF;IACA,MAAMc,mBAAmB,GAAIC,GAAG,IAAK;MACnC7D,MAAM,CAAC8D,SAAS,CAACC,aAAa,CAC5B,MAAM,EACLC,MAAM,IAAKH,GAAG,CAACI,SAAS,CAACD,MAAM,CAClC,CAAC;IACH,CAAC;IACD,MAAME,oBAAoB,GAAGA,CAAA,KAAM;MACjClE,MAAM,CAAC8D,SAAS,CAACK,MAAM,CAAC,MAAM,CAAC;MAC/BnE,MAAM,CAACoE,WAAW,CAACC,GAAG,CAAC,CAAC;MACxBrE,MAAM,CAACsE,KAAK,CAAC,CAAC;IAChB,CAAC;IACDtE,MAAM,CAAC+C,EAAE,CAACC,QAAQ,CAACuB,eAAe,CAACrB,gBAAO,CAACC,OAAO,CAACqB,SAAS,EAAE;MAC5DnB,IAAI,EAAE,YAAY;MAClBC,OAAO,EAAE,YAAY;MACrBC,QAAQ,EAAEW,oBAAoB;MAC9BO,OAAO,EAAEb;IACX,CAAC,CAAC;IACF;IACA,MAAMc,qBAAqB,GAAGA,CAAA,KAAM;MAClC1E,MAAM,CAAC2E,WAAW,CAAC,iBAAiB,EAAE,KAAK,EAAE,OAAO,CAAC;IACvD,CAAC;IACD3E,MAAM,CAAC+C,EAAE,CAACC,QAAQ,CAAC4B,OAAO,CAAC,cAAc,EAAE1B,gBAAO,CAAC2B,gBAAgB,CAAC;IACpE7E,MAAM,CAAC+C,EAAE,CAACC,QAAQ,CAACC,SAAS,CAAC,mBAAmB,EAAE;MAChDI,IAAI,EAAE,cAAc;MACpBM,IAAI,EAAE,OAAO;MACbL,OAAO,EAAE,gHAAgH;MACzHC,QAAQ,EAAEmB;IACZ,CAAC,CAAC;IACF,IAAI1D,UAAU,KAAK,YAAY,EAAE;MAC/BhB,MAAM,CAAC8E,EAAE,CAAC,MAAM,EAAE,MAAM;QACtB9F,OAAM,CAAC6B,sBAAsB,CAAC;UAC5Bb,MAAM;UACNe,SAAS;UACTC,UAAU;UACVC,cAAc;UACdhB;QACF,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ;IACAD,MAAM,CAAC8E,EAAE,CAAC,aAAa,EAAGC,CAAC,IAAK;MAC9B,IAAI/D,UAAU,KAAK,MAAM,IAAI+D,CAAC,CAACC,OAAO,KAAK,UAAU,EAAE;QACrDhG,OAAM,CAAC6B,sBAAsB,CAAC;UAAEb,MAAM;UAAEe;QAAU,CAAC,CAAC;MACtD;MACA,IAAIgE,CAAC,CAACC,OAAO,KAAK,cAAc,EAAE;QAChChF,MAAM,CAAC8D,SAAS,CAACmB,MAAM,CAAC,YAAY,CAAC;QACrCjF,MAAM,CAAC8D,SAAS,CAACmB,MAAM,CAAC,OAAO,CAAC;MAClC;IACF,CAAC,CAAC;IACF;IACAjF,MAAM,CAAC8E,EAAE,CAAC,eAAe,EAAE9C,qBAAqB,CAAC;MAAEhC,MAAM;MAAEpB,SAAS,EAAE2D,MAAM;MAAEL;IAAS,CAAC,CAAC,CAAC;EAC5F,CAAC;AAAA;;AAED;AAAAzD,OAAA,CAAAkE,mBAAA,GAAAA,mBAAA;AACO,MAAMuC,qBAAqB,GAAI5F,GAAG,IAAKA,GAAG,CAACsB,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC;AAACnC,OAAA,CAAAyG,qBAAA,GAAAA,qBAAA;AAEvE,MAAMC,YAAY,GAAGC,KAAA,IAgBtB;EAAA,IAhBuB;IAC3BpE,UAAU;IACVqE,YAAY;IACZvG,iBAAiB;IACjByD,MAAM;IACNtB,cAAc;IACdqE,iBAAiB;IACjBC,SAAS;IACTC,WAAW;IACXC,gBAAgB;IAChB5C,YAAY;IACZC,mBAAmB;IACnB4C,YAAY;IACZzF,aAAa;IACbC,OAAO;IACPyF;EACF,CAAC,GAAAP,KAAA;EACC,MAAM;IACJQ,OAAO;IACPC,MAAM;IACNC,OAAO;IACPC,YAAY;IACZC,sBAAsB;IACtBC;EACF,CAAC,GAAG,IAAAC,qBAAY,EAAC;IAAEX,SAAS;IAAEC,WAAW;IAAExE;EAAW,CAAC,CAAC;EAExD,OAAO;IACLmF,MAAM,EAAEA,CAACC,GAAG,EAAEpG,MAAM,KAAK;MACvBqF,YAAY,CAACrF,MAAM,CAAC;MACpB,IAAIgB,UAAU,KAAK,MAAM,EAAE;QACzByE,gBAAgB,CAAC,CAAC;MACpB;IACF,CAAC;IACDY,YAAY,EAAEvH,iBAAiB,IAAI,EAAE;IACrCwH,IAAI,EAAA/J,aAAA,CAAAA,aAAA,KACCsJ,MAAM;MACTU,IAAI,EAAE,KAAK;MACXC,WAAW,EAAE,KAAK;MAClBC,aAAa,EAAEC,sBAAa;MAC5BC,UAAU,EAAEhB,SAAS;MACrBiB,WAAW,EAAE,YAAY;MACzBC,iBAAiB,EAAE5F,cAAc;MACjC6F,qBAAqB,EAAE,CAAC5B,qBAAqB,CAACjE,cAAc,CAAC,EAAEiE,qBAAqB,CAACI,iBAAiB,CAAC,CAAC;MACxGyB,kBAAkB,EAAEhB,YAAY;MAChCiB,OAAO,EAAE;QAAEzG,KAAK,EAAE;UAAE0G,MAAM,EAAE;QAAQ;MAAE,CAAC;MACvCC,KAAK,EAAElI,OAAM,CAAC2D,mBAAmB,CAAC;QAChC3B,UAAU;QACVf,aAAa;QACb4C,YAAY;QACZC,mBAAmB;QACnB7B,cAAc;QACdiB,QAAQ,EAAEwD,YAAY;QACtBxF,OAAO;QACPqC,MAAM;QACNxB,SAAS,EAAE/B,OAAM,CAACmI,cAAc,CAAC5E,MAAM;MACzC,CAAC,CAAC;MACF6E,wBAAwB,EAAEpB,sBAAsB;MAChDqB,2BAA2B,EAAEpB,yBAAyB;MACtDqB,uBAAuB,EAAE,KAAK;MAC9B1B,OAAO;MACPE,OAAO;MACPyB,cAAc,EAAE,cAAc;MAC9BC,cAAc,EAAE,MAAM;MACtBC,eAAe,EAAE;IAAO;EAE5B,CAAC;AACH,CAAC;AAAChJ,OAAA,CAAA0G,YAAA,GAAAA,YAAA;AAEK,MAAMuC,gBAAgB,GAAGA,CAAA,KAAM;EACpC;EACA,MAAMC,SAAS,GAAG,IAAA/H,aAAM,EAAC,IAAI,CAAC;EAC9B;EACA,MAAMyF,YAAY,GAAG,IAAAuC,kBAAW,EAAEC,GAAG,IAAK;IACxCF,SAAS,CAAClI,OAAO,GAAGoI,GAAG;EACzB,CAAC,EAAE,EAAE,CAAC;EACN,MAAM,CAACrJ,QAAQ,EAAEsJ,WAAW,CAAC,GAAG9I,OAAM,CAACf,KAAK,CAACO,QAAQ,CAAC,KAAK,CAAC;EAC5D;EACA,IAAAqB,gBAAS,EAAC,MAAMiI,WAAW,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;EACtC,OAAO;IAAEH,SAAS;IAAEnJ,QAAQ;IAAE6G;EAAa,CAAC;AAC9C,CAAC;AAAC5G,OAAA,CAAAiJ,gBAAA,GAAAA,gBAAA;AAEK,MAAMK,cAAc,GAAGA,CAAA,KAAM;EAClC,MAAM,CAACC,SAAS,EAAEC,SAAS,CAAC,GAAGjJ,OAAM,CAACf,KAAK,CAACE,gBAAgB,CAAC,KAAK,CAAC;EACnE,OAAO;IACL6J,SAAS;IACTnF,YAAY,EAAEA,CAAA,KAAMoF,SAAS,CAAC,IAAI,CAAC;IACnCC,aAAa,EAAEA,CAAA,KAAMD,SAAS,CAAC,KAAK;EACtC,CAAC;AACH,CAAC;AAACxJ,OAAA,CAAAsJ,cAAA,GAAAA,cAAA;AAEK,MAAMI,qBAAqB,GAAIR,SAAS,IAAK;EAClD,MAAM,CAACS,gBAAgB,EAAEH,SAAS,CAAC,GAAGjJ,OAAM,CAACf,KAAK,CAACK,qBAAqB,CAAC,KAAK,CAAC;EAC/E,OAAO;IACL8J,gBAAgB;IAChBtF,mBAAmB,EAAEA,CAAA,KAAMmF,SAAS,CAAC,IAAI,CAAC;IAC1CI,oBAAoB,EAAEA,CAAA,KAAM;MAC1BJ,SAAS,CAAC,KAAK,CAAC;MAChBN,SAAS,CAAClI,OAAO,CAAC6E,KAAK,CAAC,CAAC;IAC3B;EACF,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA7F,OAAA,CAAA0J,qBAAA,GAAAA,qBAAA;AAQO,MAAMG,eAAe,GAAG,oCAAoC;;AAEnE;AACA;AACA;AACA;AACA;AAJA7J,OAAA,CAAA6J,eAAA,GAAAA,eAAA;AAKO,MAAMC,8BAA8B,GAAGA,CAACC,CAAC,EAAEC,CAAC,KAAK;EACtD,IAAI,CAACD,CAAC,IAAI,CAACC,CAAC,IAAI,EAAE,OAAOD,CAAC,KAAK,QAAQ,CAAC,IAAI,EAAE,OAAOC,CAAC,KAAK,QAAQ,CAAC,EAAE;IAAE,OAAO,IAAI;EAAE;EACrF,MAAMC,MAAM,GAAGC,IAAI,CAACC,SAAS,CAACJ,CAAC,CAACK,KAAK,CAACP,eAAe,CAAC,EAAEQ,KAAK,GAAG,CAAC,CAAC,CAAC;EACnE,MAAMC,MAAM,GAAGJ,IAAI,CAACC,SAAS,CAACH,CAAC,CAACI,KAAK,CAACP,eAAe,CAAC,EAAEQ,KAAK,GAAG,CAAC,CAAC,CAAC;EACnE,OAAOJ,MAAM,IAAIA,MAAM,KAAKK,MAAM;AACpC,CAAC;AAACtK,OAAA,CAAA8J,8BAAA,GAAAA,8BAAA;AAEK,MAAMS,gBAAgB,GAAIC,UAAU,IAAKC,QAAQ,CAACC,WAAW,CAAC,CAAC,CAACC,wBAAwB,CAACH,UAAU,CAAC;AAACxK,OAAA,CAAAuK,gBAAA,GAAAA,gBAAA;AAErG,MAAM3J,sBAAsB,GAAGA,CAAC4J,UAAU,EAAEI,QAAQ,KAAK;EAC9D,MAAM9G,MAAM,GAAGyG,gBAAgB,CAACC,UAAU,CAAC,EAAEK,gBAAgB,CAAC,KAAK,CAAC,IAAI,EAAE;EAE1E,OAAOC,KAAK,CAACC,IAAI,CAACjH,MAAM,CAAC,CAACkH,IAAI,CAAEC,GAAG,IAAKnB,8BAA8B,CAACmB,GAAG,CAACvI,GAAG,IAAI,EAAE,EAAEkI,QAAQ,CAAC,CAAC;AAClG,CAAC;AAAC5K,OAAA,CAAAY,sBAAA,GAAAA,sBAAA;AAEK,MAAMsK,wBAAwB,GAAGC,KAAA,IAAqC;EAAA,IAApC;IAAEC,cAAc;IAAEC;EAAY,CAAC,GAAAF,KAAA;EACtE,IAAI,CAACC,cAAc,CAAClN,MAAM,EAAE;IAAE,OAAO,IAAI;EAAE;EAC3C,IAAIkN,cAAc,CAAClN,MAAM,GAAG,CAAC,EAAE;IAAE,OAAO,IAAI;EAAE;EAE9C,IAAI,CAAC4L,8BAA8B,CAACsB,cAAc,CAAC,CAAC,CAAC,CAACE,EAAE,EAAED,WAAW,CAAC3I,GAAG,CAAC,EAAE;IAAE,OAAO,IAAI;EAAE;EAC3F,IAAI,CAAC0I,cAAc,CAAC,CAAC,CAAC,CAACtK,KAAK,IAAI,CAACsK,cAAc,CAAC,CAAC,CAAC,CAACrK,MAAM,EAAE;IAAE,OAAO,IAAI;EAAE;EAC1E,IAAIqK,cAAc,CAAC,CAAC,CAAC,CAACtK,KAAK,KAAKuK,WAAW,CAACvK,KAAK,EAAE;IAAE,OAAO,IAAI;EAAE;EAClE,IAAIsK,cAAc,CAAC,CAAC,CAAC,CAACrK,MAAM,KAAKsK,WAAW,CAACtK,MAAM,EAAE;IAAE,OAAO,IAAI;EAAE;EAEpE,OAAO,KAAK;AACd,CAAC;AAACf,OAAA,CAAAkL,wBAAA,GAAAA,wBAAA;AAEK,MAAMlG,0BAA0B,GAAGuG,KAAA;EAAA,IAAC;IACzChK,MAAM;IAAEuC,MAAM;IAAEL,QAAQ;IAAEW;EAC5B,CAAC,GAAAmH,KAAA;EAAA,OAAK,MAAM;IACV,MAAMF,WAAW,GAAG9J,MAAM,CAACoC,SAAS,CAACC,OAAO,CAAC,CAAC;IAC9C,MAAM;MAAElB,GAAG,EAAE8I;IAAO,CAAC,GAAGH,WAAW;IAEnC,MAAMD,cAAc,GAAGtH,MAAM,CAAC9C,OAAO,CAACvD,MAAM,CAACiD,KAAK,IAAIoJ,8BAA8B,CAACpJ,KAAK,CAAC4K,EAAE,EAAEE,MAAM,CAAC,CAAC;IAEvG,MAAMC,0BAA0B,GAAGP,wBAAwB,CAAC;MAAEG,WAAW;MAAED;IAAe,CAAC,CAAC;IAE5F,MAAMtK,KAAK,GAAG2K,0BAA0B,GAAG,IAAI,GAAGL,cAAc,CAAC,CAAC,CAAC,EAAEtK,KAAK;IAC1E,MAAMC,MAAM,GAAG0K,0BAA0B,GAAG,IAAI,GAAGL,cAAc,CAAC,CAAC,CAAC,EAAErK,MAAM;IAE5E0C,QAAQ,CAAC;MACPO,WAAW,EAAEqH,WAAW,CAAC3I,GAAG;MAC5BuB,OAAO,EAAEoH,WAAW,CAAC3H,GAAG;MACxB5C,KAAK;MACLC;IACF,CAAC,CAAC;IAEFqD,YAAY,CAAC,CAAC;EAChB,CAAC;AAAA;AAACpE,OAAA,CAAAgF,0BAAA,GAAAA,0BAAA;AAEK,MAAMxE,YAAY,GAAGkL,MAAA,IAAgB;EAAA,IAAf;IAAEtL;EAAO,CAAC,GAAAsL,MAAA;EACrC,IAAI5H,MAAM,GAAG,EAAE;EACf,MAAM6H,UAAU,GAAGjP,MAAM,CAACkP,MAAM,CAACxL,MAAM,CAAC;EACxC,IAAIuL,UAAU,CAACzN,MAAM,GAAG,CAAC,EAAE;IACzB4F,MAAM,GAAG6H,UAAU,CAAClO,MAAM,CAACoO,KAAK,IAAIA,KAAK,EAAEC,WAAW,EAAE/J,UAAU,CAAC,QAAQ,CAAC,CAAC;EAC/E;EACA,OAAO+B,MAAM;AACf,CAAC;AAAC9D,OAAA,CAAAQ,YAAA,GAAAA,YAAA;AAEK,MAAMuL,mBAAmB,GAAGC,MAAA,IAA6C;EAAA,IAA5C;IAAEC,WAAW;IAAE7L,MAAM;IAAEoC;EAAe,CAAC,GAAAwJ,MAAA;EACzE;AACF;AACA;AACA;AACA;;EAEE;EACA;EACA,MAAME,mBAAmB,GAAGC,MAAM,CAAC3J,cAAc,EAAE,GAAG,CAAC;EACvD,IAAIf,OAAO,GAAGwK,WAAW,CAAC9J,OAAO,CAAC+J,mBAAmB,EAAE,EAAE,CAAC;EAE1D,MAAME,SAAS,GAAG,EAAE;EACpB,MAAMT,UAAU,GAAGjP,MAAM,CAACkP,MAAM,CAACxL,MAAM,CAAC;EACxCuL,UAAU,CAACvN,OAAO,CAACyN,KAAK,IAAI;IAC1BO,SAAS,CAACxO,IAAI,CAAC;MAAEyO,WAAW,EAAER,KAAK,CAACQ,WAAW;MAAEjJ,WAAW,EAAEyI,KAAK,CAACzI;IAAY,CAAC,CAAC;EACpF,CAAC,CAAC;EACF,MAAMkJ,SAAS,GAAG,OAAO7K,OAAO,KAAK,QAAQ,GAAGA,OAAO,CAACG,KAAK,CAAC,uCAAuC,CAAC,GAAG,EAAE;EAC3G0K,SAAS,CAAClO,OAAO,CAACsE,GAAG,IAAI;IACvB,IAAIA,GAAG,CAACX,UAAU,CAAC,QAAQ,CAAC,IAAIqK,SAAS,CAAClO,MAAM,GAAG,CAAC,EAAE;MACpD,MAAMqO,cAAc,GAAG7J,GAAG,CAACM,SAAS,CAACN,GAAG,CAACO,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAEP,GAAG,CAAC8J,MAAM,CAAC,YAAY,CAAC,CAAC;MACpF,MAAMC,iBAAiB,GAAGF,cAAc,CAACvJ,SAAS,CAACuJ,cAAc,CAACtJ,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;MACnF,MAAMyJ,iBAAiB,GAAGH,cAAc,CAACvJ,SAAS,CAACuJ,cAAc,CAACtJ,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;MACnF,IAAIoJ,WAAW;MACfD,SAAS,CAAChO,OAAO,CAAEyC,GAAG,IAAK;QACzB,MAAMuC,WAAW,GAAGvC,GAAG,CAACuC,WAAW,CAACjB,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;QACvD,IAAIiB,WAAW,KAAKqJ,iBAAiB,IAAIrJ,WAAW,KAAKsJ,iBAAiB,EAAE;UAC1EL,WAAW,GAAGxL,GAAG,CAACwL,WAAW;QAC/B;MACF,CAAC,CAAC;MACF,IAAIA,WAAW,EAAE;QACf,MAAMhJ,UAAU,GAAGX,GAAG,CAACM,SAAS,CAAC,CAAC,EAAEN,GAAG,CAAC8J,MAAM,CAAC,YAAY,CAAC,CAAC;QAC7D,MAAM3K,cAAc,GAAGJ,OAAO,CAACU,OAAO,CAACkB,UAAU,EAAEgJ,WAAW,CAAC;QAC/D5K,OAAO,GAAGI,cAAc;MAC1B;IACF;EACF,CAAC,CAAC;EACF,OAAOJ,OAAO;AAChB,CAAC;AAACzB,OAAA,CAAA+L,mBAAA,GAAAA,mBAAA;AAEK,MAAMrD,cAAc,GAAI5E,MAAM,IAAK;EACxC,MAAMxB,SAAS,GAAG,EAAE;EACpBwB,MAAM,CAAC9C,OAAO,CAAC5C,OAAO,CAACsC,KAAK,IAAI;IAC9B4B,SAAS,CAAC1E,IAAI,CAAC;MAAEgF,aAAa,EAAElC,KAAK,CAACkC,aAAa;MAAEQ,WAAW,EAAE1C,KAAK,CAAC0C;IAAY,CAAC,CAAC;EACxF,CAAC,CAAC;EACF,OAAOd,SAAS;AAClB,CAAC;AAACtC,OAAA,CAAA0I,cAAA,GAAAA,cAAA;AAEK,MAAMiE,aAAa,GAAIhN,GAAG,IAAK;EACpC,MAAM,CAACgE,SAAS,EAAEsD,YAAY,CAAC,GAAG1G,OAAM,CAACf,KAAK,CAACM,cAAc,CAACH,GAAG,CAAC;EAClE,OAAO;IACLiN,cAAc,EAAEA,CAAA,KAAM3F,YAAY,CAAC,IAAI,CAAC;IACxCtD,SAAS;IACTsD;EACF,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZAjH,OAAA,CAAA2M,aAAA,GAAAA,aAAA;AAaO,MAAM9I,qBAAqB,GAAGgJ,MAAA,IAE/B;EAAA,IAFgC;IACpC/I,MAAM;IAAEjD,GAAG;IAAEC,KAAK;IAAEC;EACtB,CAAC,GAAA8L,MAAA;EACC,IAAIC,UAAU,GAAG,KAAK;EAEtB,MAAM/I,MAAM,GAAGD,MAAM,CAACrD,GAAG,CAAEC,KAAK,IAAK;IACnC,MAAMqM,eAAe,GAAGrM,KAAK,CAAC4K,EAAE,IAAI5K,KAAK,CAACG,GAAG,IAAIH,KAAK,CAACgC,GAAG,IAAIhC,KAAK,CAACsD,WAAW;IAC/E,MAAMgJ,OAAO,GAAGlD,8BAA8B,CAACiD,eAAe,EAAElM,GAAG,CAAC;IACpE,IAAImM,OAAO,EAAE;MACXF,UAAU,GAAG,IAAI;MACjB,OAAAhP,aAAA,CAAAA,aAAA,KAAY4C,KAAK;QAAEI,KAAK;QAAEC;MAAM;IAClC;IACA,OAAOL,KAAK;EACd,CAAC,CAAC;EAEF,OAAO;IAAEqD,MAAM;IAAE+I;EAAW,CAAC;AAC/B,CAAC;AAAC9M,OAAA,CAAA6D,qBAAA,GAAAA,qBAAA"}