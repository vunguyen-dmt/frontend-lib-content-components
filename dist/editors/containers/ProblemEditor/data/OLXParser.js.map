{"version":3,"file":"OLXParser.js","names":["_fastXmlParser","require","_lodashEs","_interopRequireDefault","_problem","obj","__esModule","default","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","key","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","indexToLetterMap","exports","Array","map","val","i","fromCharCode","nonQuestionKeys","responseKeys","stripNonTextTags","_ref","tag","stripedTags","entries","_ref2","OLXParser","constructor","olxString","baseParserOptions","ignoreAttributes","numberParseOptions","leadingZeros","hex","processEntities","problem","parserOptions","alwaysCreateTextNode","builderOptions","parser","XMLParser","builder","XMLBuilder","parsedOLX","parse","_","has","richTextProblem","richTextOptions","preserveOrder","trimValues","richTextBuilderOptions","richTextParser","richTextBuilder","richTextOLX","getPreservedAnswersAndFeedback","problemType","widgetName","option","problemBody","section","includes","isChoiceProblem","ProblemTypeKeys","NUMERIC","TEXTINPUT","preservedAnswers","correctAnswerFeedbackTag","incorrectAnswerFeedbackTag","problemBodyArr","subtag","tagNames","unshift","currentAnswerArr","answer","parseMultipleChoiceAnswers","answers","data","widget","get","permissableTags","some","Error","choice","isComplexAnswer","RichTextProblems","isEmpty","id","title","correct","isArray","element","index","preservedAnswer","preservedFeedback","build","eval","toLowerCase","feedback","getAnswerFeedback","groupFeedbackList","getGroupedFeedback","hintKey","feedbackKeys","feedbackArr","isSelectedFeedback","choices","groupFeedback","groupFeedbackArray","compoundhint","parsedFeedback","split","parseStringResponse","firstCorrectFeedback","stringresponse","answerFeedback","additionalStringAttributes","firstFeedback","getFeedback","selectedFeedback","additionalAnswerFeedback","stringEqualHintFeedback","additionalAnswer","newAnswer","indx","stringEqualHint","stringequalhint","type","textline","size","parseNumericResponse","numericalresponse","responseParam","defaultValue","isAnswerRange","test","parseQuestions","problemArray","questionArray","tagName","subTag","subTagName","questionString","replace","getHints","hintsObject","preservedProblem","objKeys","currentDemandHint","demandhint","hintValue","getSolutionExplanation","solutionBody","divBody","solution","solutionArray","div","tagText","values","toString","trim","solutionString","xmlElement","feedbackString","getProblemType","problemKeys","problemTypeKeys","indexOf","ADVANCED","getGeneralFeedback","_ref3","SINGLESELECT","DROPDOWN","firstIncorrectAnswerText","find","isAllIncorrectSelectedFeedbackTheSame","every","getParsedOLXData","settingsOlxAttributes","answersObject","additionalAttributes","hints","question","solutionExplanation","MULTISELECT","settings","generalFeedback","toleranceValue","tolerance","parseInt","slice"],"sources":["../../../../../src/editors/containers/ProblemEditor/data/OLXParser.js"],"sourcesContent":["// Parse OLX to JavaScript objects.\n/* eslint no-eval: 0 */\n\nimport { XMLParser, XMLBuilder } from 'fast-xml-parser';\nimport _ from 'lodash-es';\nimport { ProblemTypeKeys, RichTextProblems, settingsOlxAttributes } from '../../../data/constants/problem';\n\nexport const indexToLetterMap = [...Array(26)].map((val, i) => String.fromCharCode(i + 65));\n\nexport const nonQuestionKeys = [\n  '@_answer',\n  '@_type',\n  'additional_answer',\n  'checkboxgroup',\n  'choicegroup',\n  'choiceresponse',\n  'correcthint',\n  'demandhint',\n  'formulaequationinput',\n  'multiplechoiceresponse',\n  'numericalresponse',\n  'optioninput',\n  'optionresponse',\n  'responseparam',\n  'solution',\n  'stringequalhint',\n  'stringresponse',\n  'textline',\n];\n\nexport const responseKeys = [\n  'multiplechoiceresponse',\n  'numericalresponse',\n  'optionresponse',\n  'stringresponse',\n  'choiceresponse',\n  'multiplechoiceresponse',\n  'truefalseresponse',\n  'optionresponse',\n  'numericalresponse',\n  'stringresponse',\n  'customresponse',\n  'symbolicresponse',\n  'coderesponse',\n  'externalresponse',\n  'formularesponse',\n  'schematicresponse',\n  'imageresponse',\n  'annotationresponse',\n  'choicetextresponse',\n];\n\nexport const stripNonTextTags = ({ input, tag }) => {\n  const stripedTags = {};\n  Object.entries(input).forEach(([key, value]) => {\n    if (key !== tag) {\n      stripedTags[key] = value;\n    }\n  });\n  return stripedTags;\n};\n\nexport class OLXParser {\n  constructor(olxString) {\n    // There are two versions of the parsed XLM because the fields using tinymce require the order\n    // of the parsed data and spacing values to be preserved. However, all the other widgets need\n    // the data grouped by the wrapping tag. Examples of the parsed format can be found here:\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md\n    const baseParserOptions = {\n      ignoreAttributes: false,\n      numberParseOptions: {\n        leadingZeros: false,\n        hex: false,\n      },\n      processEntities: false,\n    };\n\n    // Base Parser\n    this.problem = {};\n    const parserOptions = {\n      ...baseParserOptions,\n      alwaysCreateTextNode: true,\n    };\n    const builderOptions = {\n      ...baseParserOptions,\n    };\n    const parser = new XMLParser(parserOptions);\n    this.builder = new XMLBuilder(builderOptions);\n    this.parsedOLX = parser.parse(olxString);\n    if (_.has(this.parsedOLX, 'problem')) {\n      this.problem = this.parsedOLX.problem;\n    }\n\n    // Parser with `preservedOrder: true` and `trimValues: false`\n    this.richTextProblem = [];\n    const richTextOptions = {\n      ...baseParserOptions,\n      alwaysCreateTextNode: true,\n      preserveOrder: true,\n      trimValues: false,\n    };\n    const richTextBuilderOptions = {\n      ...baseParserOptions,\n      preserveOrder: true,\n      trimValues: false,\n    };\n    const richTextParser = new XMLParser(richTextOptions);\n    this.richTextBuilder = new XMLBuilder(richTextBuilderOptions);\n    this.richTextOLX = richTextParser.parse(olxString);\n    if (_.has(this.parsedOLX, 'problem')) {\n      this.richTextProblem = this.richTextOLX[0].problem;\n    }\n  }\n\n  /** getPreservedAnswersAndFeedback(problemType, widgetName, option)\n   * getPreservedAnswersAndFeedback takes a problemType, widgetName, and a valid option. The\n   * olx for the given problem type and widget is parsed. Do to the structure of xml that is\n   * parsed with the prsereved attribute, the function has to loop through arrays of objects.\n   * The first for-loop checks for feedback tags and answer choices and appended to the\n   * preservedAnswers. The nested for loop checks for feedback and answer values inside the\n   * option (answer) tags.\n   * @param {string} problemType - string of the olx problem type\n   * @param {string} widgetName - string of the wrapping tag name\n   *                              (optioninput, choicegroup, checkboxgroup, additional_answer)\n   * @param {string} option - string of the type of answers (choice, option, correcthint, stringequalhint)\n   * @return {array} array containing answer objects and possibly an array of grouped feedback\n   */\n  getPreservedAnswersAndFeedback(problemType, widgetName, option) {\n    const [problemBody] = this.richTextProblem.filter(section => Object.keys(section).includes(problemType));\n    const isChoiceProblem = !([ProblemTypeKeys.NUMERIC, ProblemTypeKeys.TEXTINPUT].includes(problemType));\n    const preservedAnswers = [];\n    let correctAnswerFeedbackTag = option;\n    let incorrectAnswerFeedbackTag;\n    if (problemType === ProblemTypeKeys.TEXTINPUT) {\n      [correctAnswerFeedbackTag, incorrectAnswerFeedbackTag] = option;\n    }\n    const problemBodyArr = problemBody[problemType];\n    problemBodyArr.forEach(subtag => {\n      const tagNames = Object.keys(subtag);\n      if (!isChoiceProblem && tagNames.includes(correctAnswerFeedbackTag)) {\n        preservedAnswers.unshift(subtag[correctAnswerFeedbackTag]);\n      }\n      if (problemType === ProblemTypeKeys.TEXTINPUT && tagNames.includes(incorrectAnswerFeedbackTag)) {\n        preservedAnswers.push(subtag);\n      }\n      if (tagNames.includes(widgetName)) {\n        const currentAnswerArr = subtag[widgetName];\n        currentAnswerArr.forEach(answer => {\n          if (Object.keys(answer).includes(correctAnswerFeedbackTag)) {\n            preservedAnswers.push(answer[correctAnswerFeedbackTag]);\n          }\n        });\n      }\n    });\n    return preservedAnswers;\n  }\n\n  /** parseMultipleChoiceAnswers(problemType, widgetName, option)\n   * parseMultipleChoiceAnswers takes a problemType, widgetName, and a valid option. The\n   * olx for the given problem type and widget is parsed. Depending on the problem\n   * type, the title for an answer will be parsed differently because of single select and multiselect\n   * problems are rich text while dropdown answers are plain text. The rich text is parsed into an object\n   * and is converted back into a string before being added to the answer object. The parsing returns a\n   * data object with an array of answer objects. If the olx has grouped feedback, this will also be\n   * included in the data object.\n   * @param {string} problemType - string of the olx problem type\n   * @param {string} widgetName - string of the wrapping tag name (optioninput, choicegroup, checkboxgroup)\n   * @param {string} option - string of the type of answers (choice or option)\n   * @return {object} object containing an array of answer objects and possibly an array of grouped feedback\n   */\n  parseMultipleChoiceAnswers(problemType, widgetName, option) {\n    const preservedAnswers = this.getPreservedAnswersAndFeedback(\n      problemType,\n      widgetName,\n      option,\n    );\n    const answers = [];\n    let data = {};\n    const widget = _.get(this.problem, `${problemType}.${widgetName}`);\n    const permissableTags = ['choice', '@_type', 'compoundhint', 'option', '#text'];\n    if (_.keys(widget).some((tag) => !permissableTags.includes(tag))) {\n      throw new Error('Misc Tags, reverting to Advanced Editor');\n    }\n    if (_.get(this.problem, `${problemType}.@_partial_credit`)) {\n      throw new Error('Partial credit not supported by GUI, reverting to Advanced Editor');\n    }\n    const choice = _.get(widget, option);\n    const isComplexAnswer = RichTextProblems.includes(problemType);\n    if (_.isEmpty(choice)) {\n      answers.push(\n        {\n          id: indexToLetterMap[answers.length],\n          title: '',\n          correct: true,\n        },\n      );\n    } else if (_.isArray(choice)) {\n      choice.forEach((element, index) => {\n        const preservedAnswer = preservedAnswers[index].filter(answer => !Object.keys(answer).includes(`${option}hint`));\n        const preservedFeedback = preservedAnswers[index].filter(answer => Object.keys(answer).includes(`${option}hint`));\n        let title = element['#text'];\n\n        if (isComplexAnswer && preservedAnswer) {\n          title = this.richTextBuilder.build(preservedAnswer);\n        }\n        const correct = eval(element['@_correct'].toLowerCase());\n        const id = indexToLetterMap[index];\n        const feedback = this.getAnswerFeedback(preservedFeedback, `${option}hint`);\n        answers.push(\n          {\n            id,\n            correct,\n            title,\n            ...feedback,\n          },\n        );\n      });\n    } else {\n      const preservedAnswer = preservedAnswers[0].filter(answer => !Object.keys(answer).includes(`${option}hint`));\n      const preservedFeedback = preservedAnswers[0].filter(answer => Object.keys(answer).includes(`${option}hint`));\n      let title = choice['#text'];\n\n      if (isComplexAnswer && preservedAnswer) {\n        title = this.richTextBuilder.build(preservedAnswer);\n      }\n      const feedback = this.getAnswerFeedback(preservedFeedback, `${option}hint`);\n      answers.push({\n        correct: eval(choice['@_correct'].toLowerCase()),\n        id: indexToLetterMap[answers.length],\n        title,\n        ...feedback,\n      });\n    }\n    data = { answers };\n    const groupFeedbackList = this.getGroupedFeedback(widget);\n    if (groupFeedbackList.length) {\n      data = {\n        ...data,\n        groupFeedbackList,\n      };\n    }\n    return data;\n  }\n\n  /** getAnswerFeedback(preservedFeedback, hintKey)\n   * getAnswerFeedback takes preservedFeedback and a valid option. The preservedFeedback object\n   * is checked for selected and unselected feedback. The respective values are added to the\n   * feedback object. The feedback object is returned.\n   * @param {array} preservedFeedback - array of feedback objects\n   * @param {string} hintKey - string of the wrapping tag name (optionhint or choicehint)\n   * @return {object} object containing selected and unselected feedback\n   */\n  getAnswerFeedback(preservedFeedback, hintKey) {\n    const feedback = {};\n    let feedbackKeys = 'selectedFeedback';\n    if (_.isEmpty(preservedFeedback)) { return feedback; }\n\n    preservedFeedback.forEach((feedbackArr) => {\n      if (_.has(feedbackArr, hintKey)) {\n        if (_.has(feedbackArr, ':@') && _.has(feedbackArr[':@'], '@_selected')) {\n          const isSelectedFeedback = feedbackArr[':@']['@_selected'] === 'true';\n          feedbackKeys = isSelectedFeedback ? 'selectedFeedback' : 'unselectedFeedback';\n        }\n        feedback[feedbackKeys] = this.richTextBuilder.build(feedbackArr[hintKey]);\n      }\n    });\n    return feedback;\n  }\n\n  /** getGroupedFeedback(choices)\n   * getGroupedFeedback takes choices. The choices with the attribute compoundhint are parsed for\n   * the text value and the answers associated with the feedback. The groupFeedback array is returned.\n   * @param {object} choices - object of problem's subtags\n   * @return {array} array containing objects of feedback and associated answer ids\n   */\n  getGroupedFeedback(choices) {\n    const groupFeedback = [];\n    if (_.has(choices, 'compoundhint')) {\n      const groupFeedbackArray = choices.compoundhint;\n      if (_.isArray(groupFeedbackArray)) {\n        groupFeedbackArray.forEach((element) => {\n          const parsedFeedback = stripNonTextTags({ input: element, tag: '@_value' });\n          groupFeedback.push({\n            id: groupFeedback.length,\n            answers: element['@_value'].split(' '),\n            feedback: this.builder.build(parsedFeedback),\n          });\n        });\n      } else {\n        const parsedFeedback = stripNonTextTags({ input: groupFeedbackArray, tag: '@_value' });\n        groupFeedback.push({\n          id: groupFeedback.length,\n          answers: groupFeedbackArray['@_value'].split(' '),\n          feedback: this.builder.build(parsedFeedback),\n        });\n      }\n    }\n    return groupFeedback;\n  }\n\n  /** parseStringResponse()\n   * The OLX saved to the class constuctor is parsed for text input answers. There are two\n   * types of tags with the answer attribute, stringresponse (the problem wrapper) and\n   * additional_answer. Looping through each tag, the associated title and feedback are added\n   * to the answers object and appended to the answers array. The array returned in an object\n   * with the key \"answers\". The object also conatins additional attributes that belong to the\n   * string response tag.\n   * @return {object} object containing an array of answer objects and object of additionalStringAttributes\n   */\n  parseStringResponse() {\n    const [firstCorrectFeedback, ...preservedFeedback] = this.getPreservedAnswersAndFeedback(\n      ProblemTypeKeys.TEXTINPUT,\n      'additional_answer',\n      ['correcthint', 'stringequalhint'],\n    );\n    const { stringresponse } = this.problem;\n    const answers = [];\n    let answerFeedback = '';\n    let additionalStringAttributes = {};\n    let data = {};\n    const firstFeedback = this.getFeedback(firstCorrectFeedback);\n    answers.push({\n      id: indexToLetterMap[answers.length],\n      title: stringresponse['@_answer'],\n      correct: true,\n      selectedFeedback: firstFeedback,\n    });\n\n    const additionalAnswerFeedback = preservedFeedback.filter(feedback => _.isArray(feedback));\n    const stringEqualHintFeedback = preservedFeedback.filter(feedback => !_.isArray(feedback));\n\n    // Parsing additional_answer for string response.\n    const additionalAnswer = _.get(stringresponse, 'additional_answer', []);\n    if (_.isArray(additionalAnswer)) {\n      additionalAnswer.forEach((newAnswer, indx) => {\n        answerFeedback = this.getFeedback(additionalAnswerFeedback[indx]);\n        answers.push({\n          id: indexToLetterMap[answers.length],\n          title: newAnswer['@_answer'],\n          correct: true,\n          selectedFeedback: answerFeedback,\n        });\n      });\n    } else {\n      answerFeedback = this.getFeedback(additionalAnswerFeedback[0]);\n      answers.push({\n        id: indexToLetterMap[answers.length],\n        title: additionalAnswer['@_answer'],\n        correct: true,\n        selectedFeedback: answerFeedback,\n      });\n    }\n\n    // Parsing stringequalhint for string response.\n    const stringEqualHint = _.get(stringresponse, 'stringequalhint', []);\n    if (_.isArray(stringEqualHint)) {\n      stringEqualHint.forEach((newAnswer, indx) => {\n        answerFeedback = this.richTextBuilder.build(stringEqualHintFeedback[indx].stringequalhint);\n        answers.push({\n          id: indexToLetterMap[answers.length],\n          title: newAnswer['@_answer'],\n          correct: false,\n          selectedFeedback: answerFeedback,\n        });\n      });\n    } else {\n      answerFeedback = this.richTextBuilder.build(stringEqualHintFeedback[0].stringequalhint);\n      answers.push({\n        id: indexToLetterMap[answers.length],\n        title: stringEqualHint['@_answer'],\n        correct: false,\n        selectedFeedback: answerFeedback,\n      });\n    }\n\n    // TODO: Support multiple types.\n    additionalStringAttributes = {\n      type: _.get(stringresponse, '@_type'),\n      textline: {\n        size: _.get(stringresponse, 'textline.@_size'),\n      },\n    };\n\n    data = {\n      answers,\n      additionalStringAttributes,\n    };\n\n    return data;\n  }\n\n  /** parseNumericResponse()\n   * The OLX saved to the class constuctor is parsed for numeric answers. There are two\n   * types of tags for numeric answers, responseparam and additional_answer. Looping through\n   * each tag, the associated title and feedback and if the answer is an answer range are\n   * added to the answers object and appended to the answers array. The array returned in\n   * an object with the key \"answers\".\n   * @return {object} object containing an array of answer objects\n   */\n  parseNumericResponse() {\n    const [firstCorrectFeedback, ...preservedFeedback] = this.getPreservedAnswersAndFeedback(\n      ProblemTypeKeys.NUMERIC,\n      'additional_answer',\n      'correcthint',\n    );\n    const { numericalresponse } = this.problem;\n    if (_.get(numericalresponse, '@_partial_credit')) {\n      throw new Error('Partial credit not supported by GUI, reverting to Advanced Editor');\n    }\n    let answerFeedback = '';\n    const answers = [];\n    let responseParam = {};\n    const feedback = this.getFeedback(firstCorrectFeedback);\n    if (_.has(numericalresponse, 'responseparam')) {\n      const type = _.get(numericalresponse, 'responseparam.@_type');\n      const defaultValue = _.get(numericalresponse, 'responseparam.@_default');\n      responseParam = {\n        [type]: defaultValue,\n      };\n    }\n    const isAnswerRange = /[([]\\d*,\\d*[)\\]]/gm.test(numericalresponse['@_answer']);\n    answers.push({\n      id: indexToLetterMap[answers.length],\n      title: numericalresponse['@_answer'],\n      correct: true,\n      selectedFeedback: feedback,\n      isAnswerRange,\n      ...responseParam,\n    });\n\n    // Parsing additional_answer for numerical response.\n    const additionalAnswer = _.get(numericalresponse, 'additional_answer', []);\n    if (_.isArray(additionalAnswer)) {\n      additionalAnswer.forEach((newAnswer, indx) => {\n        answerFeedback = this.getFeedback(preservedFeedback[indx]);\n        answers.push({\n          id: indexToLetterMap[answers.length],\n          title: newAnswer['@_answer'],\n          correct: true,\n          selectedFeedback: answerFeedback,\n        });\n      });\n    } else {\n      answerFeedback = this.getFeedback(preservedFeedback[0]);\n      answers.push({\n        id: indexToLetterMap[answers.length],\n        title: additionalAnswer['@_answer'],\n        correct: true,\n        selectedFeedback: answerFeedback,\n        isAnswerRange: false,\n      });\n    }\n    return { answers };\n  }\n\n  /** parseQuestions(problemType)\n   * parseQuestions takes a problemType. The problem type is used to determine where the\n   * text for the question lies (sibling or child to warpping problem type tags).\n   * Using the XMLBuilder, the question is built with its proper children (including label\n   * and description). The string version of the OLX is return, replacing the description\n   * tags with italicized tags for styling purposes.\n   * @param {string} problemType - string of the olx problem type\n   * @return {string} string of OLX\n   */\n  parseQuestions(problemType) {\n    const problemArray = _.get(this.richTextProblem[0], problemType) || this.richTextProblem;\n\n    const questionArray = [];\n    problemArray.forEach(tag => {\n      const tagName = Object.keys(tag)[0];\n      if (!nonQuestionKeys.includes(tagName)) {\n        if (tagName === 'script') {\n          throw new Error('Script Tag, reverting to Advanced Editor');\n        }\n        questionArray.push(tag);\n      } else if (responseKeys.includes(tagName)) {\n        /* Tags that are not used for other parts of the question such as <solution> or <choicegroup>\n         should be included in the question. These include but are not limited to tags like <label>,\n         <description> and <table> as they often are both valid olx as siblings or children of response\n         type tags. */\n        tag[tagName].forEach(subTag => {\n          const subTagName = Object.keys(subTag)[0];\n          if (!nonQuestionKeys.includes(subTagName)) {\n            questionArray.push(subTag);\n          }\n        });\n      }\n    });\n    const questionString = this.richTextBuilder.build(questionArray);\n    return questionString.replace(/<description>/gm, '<em>').replace(/<\\/description>/gm, '</em>');\n  }\n\n  /** getHints()\n   * The OLX saved to the class constuctor is parsed for demand hint tags with hint subtags. An empty array is returned\n   * if there are no hints in the OLX. Otherwise the hint tag is parsed and appended to the hintsObject arrary. After\n   * going through all the hints the hintsObject array is returned.\n   * @return {array} array of hint objects\n   */\n  getHints() {\n    const hintsObject = [];\n    if (_.has(this.problem, 'demandhint.hint')) {\n      const preservedProblem = this.richTextProblem;\n      preservedProblem.forEach(obj => {\n        const objKeys = Object.keys(obj);\n        if (objKeys.includes('demandhint')) {\n          const currentDemandHint = obj.demandhint;\n          currentDemandHint.forEach(hint => {\n            if (Object.keys(hint).includes('hint')) {\n              const hintValue = this.richTextBuilder.build(hint.hint);\n              hintsObject.push({\n                id: hintsObject.length,\n                value: hintValue,\n              });\n            }\n          });\n        }\n      });\n    }\n    return hintsObject;\n  }\n\n  /** getSolutionExplanation(problemType)\n   * getSolutionExplanation takes a problemType. The problem type is used to determine where the\n   * text for the solution lies (sibling or child to warpping problem type tags).\n   * Using the XMLBuilder, the solution is built removing the redundant \"explanation\" that is\n   * appended for Studio styling purposes. The string version of the OLX is return.\n   * @param {string} problemType - string of the olx problem type\n   * @return {string} string of OLX\n   */\n  getSolutionExplanation(problemType) {\n    if (!_.has(this.problem, `${problemType}.solution`) && !_.has(this.problem, 'solution')) { return null; }\n    const [problemBody] = this.richTextProblem.filter(section => Object.keys(section).includes(problemType));\n    const [solutionBody] = problemBody[problemType].filter(section => Object.keys(section).includes('solution'));\n    const [divBody] = solutionBody.solution.filter(section => Object.keys(section).includes('div'));\n    const solutionArray = [];\n    if (divBody && divBody.div) {\n      divBody.div.forEach(tag => {\n        const tagText = _.get(Object.values(tag)[0][0], '#text', '');\n        if (tagText.toString().trim() !== 'Explanation') {\n          solutionArray.push(tag);\n        }\n      });\n    } else {\n      solutionBody.solution.forEach(tag => {\n        const tagText = _.get(Object.values(tag)[0][0], '#text', '');\n        if (tagText.toString().trim() !== 'Explanation') {\n          solutionArray.push(tag);\n        }\n      });\n    }\n    const solutionString = this.richTextBuilder.build(solutionArray);\n    return solutionString;\n  }\n\n  /** getFeedback(xmlElement)\n   * getFeedback takes xmlElement. The xmlElement is searched for the attribute correcthint.\n   * An empty string is returned if the parameter is not present. Otherwise a string of the feedback\n   * is returned.\n   * @param {object} xmlElement - object of answer attributes\n   * @return {string} string of feedback\n   */\n  getFeedback(xmlElement) {\n    if (_.isEmpty(xmlElement)) { return ''; }\n    const feedbackString = this.richTextBuilder.build(xmlElement);\n    return feedbackString;\n  }\n\n  /** getProblemType()\n   * The OLX saved to the class constuctor is parsed for a valid problem type (referencing problemKeys).\n   * For blank problems, it returns null. For OLX problems tags not defined in problemKeys or OLX with\n   * multiple problem tags, it returns advanced. For defined, single problem tag, it returns the\n   * associated problem type.\n   * @return {string} problem type\n   */\n  getProblemType() {\n    const problemKeys = Object.keys(this.problem);\n    const problemTypeKeys = problemKeys.filter(key => Object.values(ProblemTypeKeys).indexOf(key) !== -1);\n    if (problemTypeKeys.length === 0) {\n      // a blank problem is a problem which contains only `<problem></problem>` as it's olx.\n      // blank problems are not given types, so that a type may be selected.\n      if (problemKeys.length === 1 && problemKeys[0] === '#text' && this.problem[problemKeys[0]] === '') {\n        return null;\n      }\n      // if we have no matching problem type, the problem is advanced.\n      return ProblemTypeKeys.ADVANCED;\n    }\n    // make sure compound problems are treated as advanced\n    if ((problemTypeKeys.length > 1)\n      || (_.isArray(this.problem[problemTypeKeys[0]])\n        && this.problem[problemTypeKeys[0]].length > 1)) {\n      return ProblemTypeKeys.ADVANCED;\n    }\n    const problemType = problemTypeKeys[0];\n    return problemType;\n  }\n\n  /** getGeneralFeedback({ answers, problemType })\n   * getGeneralFeedback takes answers and problemType. The problem type determines if the problem should be checked\n   * for general feedback. The incorrect answers are checked to seee if all of their feedback is the same and\n   * returns the first incorrect answer's feedback if true. When conditions are unmet, it returns and empty string.\n   * @param {array} answers - array of answer objects\n   * @param {string} problemType - string of string of the olx problem type\n   * @return {string} text for incorrect feedback\n   */\n  getGeneralFeedback({ answers, problemType }) {\n    /* Feedback is Generalized for a Problem IFF:\n    1. The problem is of Types: Single Select or Dropdown.\n    2. All the problem's incorrect, if Selected answers are equivalent strings, and there is no other feedback.\n    */\n    if (problemType === ProblemTypeKeys.SINGLESELECT || problemType === ProblemTypeKeys.DROPDOWN) {\n      const firstIncorrectAnswerText = answers.find(answer => answer.correct === false)?.selectedFeedback;\n      const isAllIncorrectSelectedFeedbackTheSame = answers.every(answer => (answer.correct\n        ? true\n        : answer?.selectedFeedback === firstIncorrectAnswerText\n      ));\n      if (isAllIncorrectSelectedFeedbackTheSame) {\n        return firstIncorrectAnswerText;\n      }\n    }\n    return '';\n  }\n\n  getParsedOLXData() {\n    if (_.isEmpty(this.problem)) {\n      return {};\n    }\n\n    if (Object.keys(this.problem).some((key) => key.indexOf('@_') !== -1 && !settingsOlxAttributes.includes(key))) {\n      throw new Error('Misc Attributes asscoiated with problem, opening in advanced editor');\n    }\n\n    let answersObject = {};\n    let additionalAttributes = {};\n    let groupFeedbackList = [];\n    const problemType = this.getProblemType();\n    const hints = this.getHints();\n    const question = this.parseQuestions(problemType);\n    const solutionExplanation = this.getSolutionExplanation(problemType);\n\n    switch (problemType) {\n      case ProblemTypeKeys.DROPDOWN:\n        answersObject = this.parseMultipleChoiceAnswers(ProblemTypeKeys.DROPDOWN, 'optioninput', 'option');\n        break;\n      case ProblemTypeKeys.TEXTINPUT:\n        answersObject = this.parseStringResponse();\n        break;\n      case ProblemTypeKeys.NUMERIC:\n        answersObject = this.parseNumericResponse();\n        break;\n      case ProblemTypeKeys.MULTISELECT:\n        answersObject = this.parseMultipleChoiceAnswers(ProblemTypeKeys.MULTISELECT, 'checkboxgroup', 'choice');\n        break;\n      case ProblemTypeKeys.SINGLESELECT:\n        answersObject = this.parseMultipleChoiceAnswers(ProblemTypeKeys.SINGLESELECT, 'choicegroup', 'choice');\n        break;\n      case ProblemTypeKeys.ADVANCED:\n        return {\n          problemType,\n          settings: {},\n        };\n      default:\n        // if problem is unset, return null\n        return {};\n    }\n    const generalFeedback = this.getGeneralFeedback({ answers: answersObject.answers, problemType });\n    if (_.has(answersObject, 'additionalStringAttributes')) {\n      additionalAttributes = { ...answersObject.additionalStringAttributes };\n    }\n\n    if (_.has(answersObject, 'groupFeedbackList')) {\n      groupFeedbackList = answersObject.groupFeedbackList;\n    }\n    const { answers } = answersObject;\n    const settings = { hints };\n    if (ProblemTypeKeys.NUMERIC === problemType && _.has(answers[0], 'tolerance')) {\n      const toleranceValue = answers[0].tolerance;\n      if (!toleranceValue || toleranceValue.length === 0) {\n        settings.tolerance = { value: null, type: 'None' };\n      } else if (toleranceValue.includes('%')) {\n        settings.tolerance = { value: parseInt(toleranceValue.slice(0, -1)), type: 'Percent' };\n      } else {\n        settings.tolerance = { value: parseInt(toleranceValue), type: 'Number' };\n      }\n    } else {\n      settings.tolerance = { value: null, type: 'None' };\n    }\n    if (solutionExplanation) { settings.solutionExplanation = solutionExplanation; }\n\n    return {\n      question,\n      settings,\n      answers,\n      problemType,\n      additionalAttributes,\n      generalFeedback,\n      groupFeedbackList,\n    };\n  }\n}\n"],"mappings":"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"}